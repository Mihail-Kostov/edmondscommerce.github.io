<div class="highlight"><pre><span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="nx">Mage</span><span class="o">::</span><span class="na">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getRequest</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getControllerModule</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Mage_Api&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">registry</span><span class="p">(</span><span class="s1">&#39;current_shipment&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">registry</span><span class="p">(</span><span class="s1">&#39;sales_order&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">registry</span><span class="p">(</span><span class="s1">&#39;current_creditmemo&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">registry</span><span class="p">(</span><span class="s1">&#39;current_invoice&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$order</span><span class="o">-&gt;</span><span class="na">getPayment</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getMethod</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;sagepayrepeat&#39;</span><span class="p">)</span> <span class="p">){</span>
</pre></div>