<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nb">set_time_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="cm">/*---------------------------------------------------+</span>

<span class="cm">| mysqldump.php</span>

<span class="cm">+----------------------------------------------------+</span>

<span class="cm">| Copyright 2006 Huang Kai</span>

<span class="cm">| hkai@atutility.com</span>

<span class="cm">| http://atutility.com/</span>

<span class="cm">+----------------------------------------------------+</span>

<span class="cm">| Released under the terms &amp; conditions of v2 of the</span>

<span class="cm">| GNU General Public License. For details refer to</span>

<span class="cm">| the included gpl.txt file or visit http://gnu.org</span>

<span class="cm">+----------------------------------------------------*/</span>

<span class="cm">/*</span>

<span class="cm">change log:</span>

<span class="cm">2006-10-16 Huang Kai</span>

<span class="cm">---------------------------------</span>

<span class="cm">initial release</span>



<span class="cm">2006-10-18 Huang Kai</span>

<span class="cm">---------------------------------</span>

<span class="cm">fixed bugs with delimiter</span>

<span class="cm">add paramter header to add field name as CSV file header.</span>



<span class="cm">2006-11-11 Huang Kia</span>

<span class="cm">Tested with IE and fixed the &lt;button&gt; to &lt;input&gt;</span>

<span class="cm">*/</span>

<span class="nv">$mysqldump_version</span><span class="o">=</span><span class="s2">&quot;1.02&quot;</span><span class="p">;</span>



<span class="nv">$print_form</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

<span class="nv">$output_messages</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>





<span class="c1">//test mysql connection</span>

<span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])</span> <span class="p">)</span>

<span class="p">{</span>

	<span class="nv">$mysql_host</span><span class="o">=</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;mysql_host&#39;</span><span class="p">];</span>

	<span class="nv">$mysql_database</span><span class="o">=</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;mysql_database&#39;</span><span class="p">];</span>

	<span class="nv">$mysql_username</span><span class="o">=</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;mysql_username&#39;</span><span class="p">];</span>

	<span class="nv">$mysql_password</span><span class="o">=</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;mysql_password&#39;</span><span class="p">];</span>



	<span class="k">if</span><span class="p">(</span> <span class="s1">&#39;Test Connection&#39;</span> <span class="o">==</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])</span>

	<span class="p">{</span>

		<span class="nx">_mysql_test</span><span class="p">(</span><span class="nv">$mysql_host</span><span class="p">,</span><span class="nv">$mysql_database</span><span class="p">,</span> <span class="nv">$mysql_username</span><span class="p">,</span> <span class="nv">$mysql_password</span><span class="p">);</span>

	<span class="p">}</span>

	<span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="s1">&#39;Export&#39;</span> <span class="o">==</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])</span>

	<span class="p">{</span>

		<span class="nx">_mysql_test</span><span class="p">(</span><span class="nv">$mysql_host</span><span class="p">,</span><span class="nv">$mysql_database</span><span class="p">,</span> <span class="nv">$mysql_username</span><span class="p">,</span> <span class="nv">$mysql_password</span><span class="p">);</span>

		<span class="k">if</span><span class="p">(</span> <span class="s1">&#39;SQL&#39;</span> <span class="o">==</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;output_format&#39;</span><span class="p">]</span> <span class="p">)</span>

		<span class="p">{</span>

			<span class="nv">$print_form</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>



			<span class="c1">//ob_start(&quot;ob_gzhandler&quot;);</span>

			<span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-type: text/plain&#39;</span><span class="p">);</span>

			<span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Disposition: attachment; filename=&quot;&#39;</span><span class="o">.</span><span class="nv">$mysql_host</span><span class="o">.</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="nv">$mysql_database</span><span class="o">.</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;YmdHis&#39;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;.sql&quot;&#39;</span><span class="p">);</span>

			<span class="k">echo</span> <span class="s2">&quot;/*mysqldump.php version </span><span class="si">$mysqldump_version</span><span class="s2"> */</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

			<span class="nx">_mysqldump</span><span class="p">(</span><span class="nv">$mysql_database</span><span class="p">);</span>



			<span class="c1">//header(&quot;Content-Length: &quot;.ob_get_length());</span>



			<span class="c1">//ob_end_flush();</span>

		<span class="p">}</span>

		<span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="s1">&#39;CSV&#39;</span> <span class="o">==</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;output_format&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;mysql_table&#39;</span><span class="p">]))</span>

		<span class="p">{</span>

			<span class="nv">$print_form</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>



			<span class="nb">ob_start</span><span class="p">(</span><span class="s2">&quot;ob_gzhandler&quot;</span><span class="p">);</span>



			<span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-type: text/comma-separated-values&#39;</span><span class="p">);</span>

			<span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Content-Disposition: attachment; filename=&quot;&#39;</span><span class="o">.</span><span class="nv">$mysql_host</span><span class="o">.</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="nv">$mysql_database</span><span class="o">.</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="nv">$mysql_table</span><span class="o">.</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;YmdHis&#39;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;.csv&quot;&#39;</span><span class="p">);</span>

			<span class="c1">//header(&#39;Content-type: text/plain&#39;);</span>

			<span class="nx">_mysqldump_csv</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;mysql_table&#39;</span><span class="p">]);</span>

			<span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Content-Length: &quot;</span><span class="o">.</span><span class="nb">ob_get_length</span><span class="p">());</span>

			<span class="nb">ob_end_flush</span><span class="p">();</span>

		<span class="p">}</span>

	<span class="p">}</span>



<span class="p">}</span>



<span class="k">function</span> <span class="nf">_mysqldump_csv</span><span class="p">(</span><span class="nv">$table</span><span class="p">)</span>

<span class="p">{</span>

	<span class="nv">$delimiter</span><span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;csv_delimiter&#39;</span><span class="p">]))</span>

		<span class="nv">$delimiter</span><span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;csv_delimiter&#39;</span><span class="p">];</span>



	<span class="k">if</span><span class="p">(</span> <span class="s1">&#39;Tab&#39;</span> <span class="o">==</span> <span class="nv">$delimiter</span><span class="p">)</span>

		<span class="nv">$delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">;</span>





	<span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;select * from `</span><span class="si">$table</span><span class="s2">`;&quot;</span><span class="p">;</span>

	<span class="nv">$result</span><span class="o">=</span><span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span> <span class="nv">$result</span><span class="p">)</span>

	<span class="p">{</span>

		<span class="nv">$num_rows</span><span class="o">=</span> <span class="nb">mysql_num_rows</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

		<span class="nv">$num_fields</span><span class="o">=</span> <span class="nb">mysql_num_fields</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>



		<span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

		<span class="k">while</span><span class="p">(</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$num_fields</span><span class="p">)</span>

		<span class="p">{</span>

			<span class="nv">$meta</span><span class="o">=</span> <span class="nb">mysql_fetch_field</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span> <span class="nv">$i</span><span class="p">);</span>

			<span class="k">echo</span><span class="p">(</span><span class="nv">$meta</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">);</span>

			<span class="k">if</span><span class="p">(</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$num_fields</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

				<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$delimiter</span><span class="s2">&quot;</span><span class="p">;</span>

			<span class="nv">$i</span><span class="o">++</span><span class="p">;</span>

		<span class="p">}</span>

		<span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>



		<span class="k">if</span><span class="p">(</span> <span class="nv">$num_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

		<span class="p">{</span>

			<span class="k">while</span><span class="p">(</span> <span class="nv">$row</span><span class="o">=</span> <span class="nb">mysql_fetch_row</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span>

			<span class="p">{</span>

				<span class="k">for</span><span class="p">(</span> <span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$num_fields</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>

				<span class="p">{</span>

					<span class="k">echo</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="nv">$i</span><span class="p">]);</span>

					<span class="k">if</span><span class="p">(</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$num_fields</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

							<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$delimiter</span><span class="s2">&quot;</span><span class="p">;</span>

				<span class="p">}</span>

				<span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

			<span class="p">}</span>



		<span class="p">}</span>

	<span class="p">}</span>

	<span class="nb">mysql_free_result</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>



<span class="p">}</span>





<span class="k">function</span> <span class="nf">_mysqldump</span><span class="p">(</span><span class="nv">$mysql_database</span><span class="p">)</span>

<span class="p">{</span>

	<span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;show tables;&quot;</span><span class="p">;</span>

	<span class="nv">$result</span><span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span> <span class="nv">$result</span><span class="p">)</span>

	<span class="p">{</span>

		<span class="k">while</span><span class="p">(</span> <span class="nv">$row</span><span class="o">=</span> <span class="nb">mysql_fetch_row</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span>

		<span class="p">{</span>

			<span class="nx">_mysqldump_table_structure</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>



			<span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;sql_table_data&#39;</span><span class="p">]))</span>

			<span class="p">{</span>

				<span class="nx">_mysqldump_table_data</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

			<span class="p">}</span>

		<span class="p">}</span>

	<span class="p">}</span>

	<span class="k">else</span>

	<span class="p">{</span>

		<span class="k">echo</span> <span class="s2">&quot;/* no tables in </span><span class="si">$mysql_database</span><span class="s2"> */</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

	<span class="p">}</span>

	<span class="nb">mysql_free_result</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

<span class="p">}</span>



<span class="k">function</span> <span class="nf">_mysqldump_table_structure</span><span class="p">(</span><span class="nv">$table</span><span class="p">)</span>

<span class="p">{</span>

	<span class="k">echo</span> <span class="s2">&quot;/* Table structure for table `</span><span class="si">$table</span><span class="s2">` */</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;sql_drop_table&#39;</span><span class="p">]))</span>

	<span class="p">{</span>

		<span class="k">echo</span> <span class="s2">&quot;DROP TABLE IF EXISTS `</span><span class="si">$table</span><span class="s2">`;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">;</span>

	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;sql_create_table&#39;</span><span class="p">]))</span>

	<span class="p">{</span>



		<span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;show create table `</span><span class="si">$table</span><span class="s2">`; &quot;</span><span class="p">;</span>

		<span class="nv">$result</span><span class="o">=</span><span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

		<span class="k">if</span><span class="p">(</span> <span class="nv">$result</span><span class="p">)</span>

		<span class="p">{</span>

			<span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span>

			<span class="p">{</span>

				<span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;Create Table&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">;</span>

			<span class="p">}</span>

		<span class="p">}</span>

		<span class="nb">mysql_free_result</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

	<span class="p">}</span>

<span class="p">}</span>



<span class="k">function</span> <span class="nf">_mysqldump_table_data</span><span class="p">(</span><span class="nv">$table</span><span class="p">)</span>

<span class="p">{</span>



	<span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;select * from `</span><span class="si">$table</span><span class="s2">`;&quot;</span><span class="p">;</span>

	<span class="nv">$result</span><span class="o">=</span><span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span> <span class="nv">$result</span><span class="p">)</span>

	<span class="p">{</span>

		<span class="nv">$num_rows</span><span class="o">=</span> <span class="nb">mysql_num_rows</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

		<span class="nv">$num_fields</span><span class="o">=</span> <span class="nb">mysql_num_fields</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>



		<span class="k">if</span><span class="p">(</span> <span class="nv">$num_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

		<span class="p">{</span>

			<span class="k">echo</span> <span class="s2">&quot;/* dumping data for table `</span><span class="si">$table</span><span class="s2">` */</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>



			<span class="nv">$field_type</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>

			<span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

			<span class="k">while</span><span class="p">(</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$num_fields</span><span class="p">)</span>

			<span class="p">{</span>

				<span class="nv">$meta</span><span class="o">=</span> <span class="nb">mysql_fetch_field</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span> <span class="nv">$i</span><span class="p">);</span>

				<span class="nb">array_push</span><span class="p">(</span><span class="nv">$field_type</span><span class="p">,</span> <span class="nv">$meta</span><span class="o">-&gt;</span><span class="na">type</span><span class="p">);</span>

				<span class="nv">$i</span><span class="o">++</span><span class="p">;</span>

			<span class="p">}</span>



			<span class="c1">//print_r( $field_type);</span>

			<span class="k">echo</span> <span class="s2">&quot;insert into `</span><span class="si">$table</span><span class="s2">` values</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

			<span class="nv">$index</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

			<span class="k">while</span><span class="p">(</span> <span class="nv">$row</span><span class="o">=</span> <span class="nb">mysql_fetch_row</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span>

			<span class="p">{</span>

				<span class="k">echo</span> <span class="s2">&quot;(&quot;</span><span class="p">;</span>

				<span class="k">for</span><span class="p">(</span> <span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$num_fields</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>

				<span class="p">{</span>

					<span class="k">if</span><span class="p">(</span> <span class="nb">is_null</span><span class="p">(</span> <span class="nv">$row</span><span class="p">[</span><span class="nv">$i</span><span class="p">]))</span>

						<span class="k">echo</span> <span class="s2">&quot;null&quot;</span><span class="p">;</span>

					<span class="k">else</span>

					<span class="p">{</span>

						<span class="k">switch</span><span class="p">(</span> <span class="nv">$field_type</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span>

						<span class="p">{</span>

							<span class="k">case</span> <span class="s1">&#39;int&#39;</span><span class="o">:</span>

								<span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>

								<span class="k">break</span><span class="p">;</span>

							<span class="k">case</span> <span class="s1">&#39;string&#39;</span><span class="o">:</span>

							<span class="k">case</span> <span class="s1">&#39;blob&#39;</span> <span class="o">:</span>

							<span class="k">default</span><span class="o">:</span>

								<span class="k">echo</span> <span class="s2">&quot;&#39;&quot;</span><span class="o">.</span><span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span><span class="o">.</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>



						<span class="p">}</span>

					<span class="p">}</span>

					<span class="k">if</span><span class="p">(</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$num_fields</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

						<span class="k">echo</span> <span class="s2">&quot;,&quot;</span><span class="p">;</span>

				<span class="p">}</span>

				<span class="k">echo</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>



				<span class="k">if</span><span class="p">(</span> <span class="nv">$index</span> <span class="o">&lt;</span> <span class="nv">$num_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

					<span class="k">echo</span> <span class="s2">&quot;,&quot;</span><span class="p">;</span>

				<span class="k">else</span>

					<span class="k">echo</span> <span class="s2">&quot;;&quot;</span><span class="p">;</span>

				<span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>



				<span class="nv">$index</span><span class="o">++</span><span class="p">;</span>

			<span class="p">}</span>

		<span class="p">}</span>

	<span class="p">}</span>

	<span class="nb">mysql_free_result</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

	<span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="p">}</span>



<span class="k">function</span> <span class="nf">_mysql_test</span><span class="p">(</span><span class="nv">$mysql_host</span><span class="p">,</span><span class="nv">$mysql_database</span><span class="p">,</span> <span class="nv">$mysql_username</span><span class="p">,</span> <span class="nv">$mysql_password</span><span class="p">)</span>

<span class="p">{</span>

	<span class="k">global</span> <span class="nv">$output_messages</span><span class="p">;</span>

	<span class="nv">$link</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="nv">$mysql_host</span><span class="p">,</span> <span class="nv">$mysql_username</span><span class="p">,</span> <span class="nv">$mysql_password</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$link</span><span class="p">)</span>

	<span class="p">{</span>

	   <span class="nb">array_push</span><span class="p">(</span><span class="nv">$output_messages</span><span class="p">,</span> <span class="s1">&#39;Could not connect: &#39;</span> <span class="o">.</span> <span class="nb">mysql_error</span><span class="p">());</span>

	<span class="p">}</span>

	<span class="k">else</span>

	<span class="p">{</span>

		<span class="nb">array_push</span> <span class="p">(</span><span class="nv">$output_messages</span><span class="p">,</span><span class="s2">&quot;Connected with MySQL server:</span><span class="si">$mysql_username</span><span class="s2">@</span><span class="si">$mysql_host</span><span class="s2"> successfully&quot;</span><span class="p">);</span>



		<span class="nv">$db_selected</span> <span class="o">=</span> <span class="nb">mysql_select_db</span><span class="p">(</span><span class="nv">$mysql_database</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$db_selected</span><span class="p">)</span>

		<span class="p">{</span>

			<span class="nb">array_push</span> <span class="p">(</span><span class="nv">$output_messages</span><span class="p">,</span><span class="s1">&#39;Can\&#39;t use $mysql_database : &#39;</span> <span class="o">.</span> <span class="nb">mysql_error</span><span class="p">());</span>

		<span class="p">}</span>

		<span class="k">else</span>

			<span class="nb">array_push</span> <span class="p">(</span><span class="nv">$output_messages</span><span class="p">,</span><span class="s2">&quot;Connected with MySQL database:</span><span class="si">$mysql_database</span><span class="s2"> successfully&quot;</span><span class="p">);</span>

	<span class="p">}</span>



<span class="p">}</span>



<span class="k">if</span><span class="p">(</span> <span class="nv">$print_form</span> <span class="o">&gt;</span><span class="mi">0</span> <span class="p">)</span>

<span class="p">{</span>

<span class="cp">?&gt;</span><span class="x"></span>

<span class="x">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&gt;</span>



<span class="x">&lt;html&gt;</span>

<span class="x">&lt;head&gt;</span>

<span class="x">&lt;title&gt;mysqldump.php version </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$mysqldump_version</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x">&lt;/title&gt;</span>

<span class="x">&lt;/head&gt;</span>



<span class="x">&lt;body&gt;</span>

<span class="cp">&lt;?php</span>

	<span class="k">foreach</span> <span class="p">(</span><span class="nv">$output_messages</span> <span class="k">as</span> <span class="nv">$message</span><span class="p">)</span>

	<span class="p">{</span>

    	<span class="k">echo</span> <span class="nv">$message</span><span class="o">.</span><span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>

	<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>

<span class="x">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span>

<span class="x">MySQL connection parameters:</span>

<span class="x">&lt;table border=&quot;0&quot;&gt;</span>

<span class="x">  &lt;tr&gt;</span>

<span class="x">    &lt;td&gt;Host:&lt;/td&gt;</span>

<span class="x">    &lt;td&gt;&lt;input  name=&quot;mysql_host&quot; value=&quot;</span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;mysql_host&#39;</span><span class="p">]))</span><span class="k">echo</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;mysql_host&#39;</span><span class="p">];</span> <span class="k">else</span> <span class="k">echo</span> <span class="s1">&#39;localhost&#39;</span><span class="p">;</span><span class="cp">?&gt;</span><span class="x">&quot;  /&gt;&lt;/td&gt;</span>

<span class="x">  &lt;/tr&gt;</span>

<span class="x">  &lt;tr&gt;</span>

<span class="x">    &lt;td&gt;Database:&lt;/td&gt;</span>

<span class="x">    &lt;td&gt;&lt;input  name=&quot;mysql_database&quot; value=&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;mysql_database&#39;</span><span class="p">];</span> <span class="cp">?&gt;</span><span class="x">&quot;  /&gt;&lt;/td&gt;</span>

<span class="x">  &lt;/tr&gt;</span>

<span class="x">  &lt;tr&gt;</span>

<span class="x">    &lt;td&gt;Username:&lt;/td&gt;</span>

<span class="x">    &lt;td&gt;&lt;input  name=&quot;mysql_username&quot; value=&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;mysql_username&#39;</span><span class="p">];</span> <span class="cp">?&gt;</span><span class="x">&quot;  /&gt;&lt;/td&gt;</span>

<span class="x">  &lt;/tr&gt;</span>

<span class="x">  &lt;tr&gt;</span>

<span class="x">    &lt;td&gt;Password:&lt;/td&gt;</span>

<span class="x">    &lt;td&gt;&lt;input  type=&quot;password&quot; name=&quot;mysql_password&quot; value=&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;mysql_password&#39;</span><span class="p">];</span> <span class="cp">?&gt;</span><span class="x">&quot;  /&gt;&lt;/td&gt;</span>

<span class="x">  &lt;/tr&gt;</span>

<span class="x">  &lt;tr&gt;</span>

<span class="x">    &lt;td&gt;Output format: &lt;/td&gt;</span>

<span class="x">    &lt;td&gt;</span>

<span class="x">      &lt;select name=&quot;output_format&quot; &gt;</span>

<span class="x">        &lt;option value=&quot;SQL&quot; </span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;output_format&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;SQL&#39;</span> <span class="o">==</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;output_format&#39;</span><span class="p">])</span> <span class="k">echo</span> <span class="s2">&quot;selected&quot;</span><span class="p">;</span><span class="cp">?&gt;</span><span class="x"> &gt;SQL&lt;/option&gt;</span>

<span class="x">        &lt;option value=&quot;CSV&quot; </span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;output_format&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;CSV&#39;</span> <span class="o">==</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;output_format&#39;</span><span class="p">])</span> <span class="k">echo</span> <span class="s2">&quot;selected&quot;</span><span class="p">;</span><span class="cp">?&gt;</span><span class="x"> &gt;CSV&lt;/option&gt;</span>



<span class="x">        &lt;/select&gt;</span>

<span class="x">    &lt;/td&gt;</span>

<span class="x">  &lt;/tr&gt;</span>

<span class="x">&lt;/table&gt;</span>

<span class="x">&lt;input type=&quot;submit&quot; name=&quot;action&quot;  value=&quot;Test Connection&quot;&gt;&lt;br /&gt;</span>



<span class="x">  &lt;br&gt;Dump options(SQL):</span>

<span class="x">  &lt;table border=&quot;0&quot;&gt;</span>



<span class="x">    &lt;tr&gt;</span>

<span class="x">      &lt;td&gt;Drop table statement: &lt;/td&gt;</span>

<span class="x">      &lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;sql_drop_table&quot; </span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;sql_drop_table&#39;</span><span class="p">]))</span> <span class="p">;</span> <span class="k">else</span> <span class="k">echo</span> <span class="s1">&#39;checked&#39;</span> <span class="cp">?&gt;</span><span class="x"> /&gt;&lt;/td&gt;</span>

<span class="x">    &lt;/tr&gt;</span>

<span class="x">    &lt;tr&gt;</span>

<span class="x">      &lt;td&gt;Create table statement: &lt;/td&gt;</span>

<span class="x">      &lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;sql_create_table&quot; </span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;sql_create_table&#39;</span><span class="p">]))</span> <span class="p">;</span> <span class="k">else</span> <span class="k">echo</span> <span class="s1">&#39;checked&#39;</span> <span class="cp">?&gt;</span><span class="x"> /&gt;&lt;/td&gt;</span>

<span class="x">    &lt;/tr&gt;</span>

<span class="x">    &lt;tr&gt;</span>

<span class="x">      &lt;td&gt;Table data: &lt;/td&gt;</span>

<span class="x">      &lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;sql_table_data&quot;  </span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;sql_table_data&#39;</span><span class="p">]))</span> <span class="p">;</span> <span class="k">else</span> <span class="k">echo</span> <span class="s1">&#39;checked&#39;</span> <span class="cp">?&gt;</span><span class="x">/&gt;&lt;/td&gt;</span>

<span class="x">    &lt;/tr&gt;</span>

<span class="x">  &lt;/table&gt;</span>

<span class="x">  &lt;br&gt;Dump options(CSV):</span>

<span class="x">  &lt;table border=&quot;0&quot;&gt;</span>

<span class="x">  &lt;tr&gt;</span>

<span class="x">    &lt;td&gt;Delimiter:&lt;/td&gt;</span>

<span class="x">    &lt;td&gt;&lt;select name=&quot;csv_delimiter&quot;&gt;</span>

<span class="x">      &lt;option value=&quot;,&quot; </span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;output_format&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;,&#39;</span> <span class="o">==</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;output_format&#39;</span><span class="p">])</span> <span class="k">echo</span> <span class="s2">&quot;selected&quot;</span><span class="p">;</span><span class="cp">?&gt;</span><span class="x">&gt;,&lt;/option&gt;</span>

<span class="x">      &lt;option value=&quot;Tab&quot; </span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;output_format&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;Tab&#39;</span> <span class="o">==</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;output_format&#39;</span><span class="p">])</span> <span class="k">echo</span> <span class="s2">&quot;selected&quot;</span><span class="p">;</span><span class="cp">?&gt;</span><span class="x">&gt;Tab&lt;/option&gt;</span>

<span class="x">      &lt;option value=&quot;|&quot; </span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;output_format&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;|&#39;</span> <span class="o">==</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;output_format&#39;</span><span class="p">])</span> <span class="k">echo</span> <span class="s2">&quot;selected&quot;</span><span class="p">;</span><span class="cp">?&gt;</span><span class="x">&gt;|&lt;/option&gt;</span>

<span class="x">    &lt;/select&gt;</span>

<span class="x">    &lt;/td&gt;</span>

<span class="x">  &lt;/tr&gt;</span>

<span class="x">  &lt;tr&gt;</span>

<span class="x">    &lt;td&gt;Table:&lt;/td&gt;</span>

<span class="x">    &lt;td&gt;&lt;input  type=&quot;input&quot; name=&quot;mysql_table&quot; value=&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;mysql_table&#39;</span><span class="p">];</span> <span class="cp">?&gt;</span><span class="x">&quot;  /&gt;&lt;/td&gt;</span>

<span class="x">  &lt;/tr&gt;</span>

<span class="x">	&lt;tr&gt;</span>

<span class="x">      &lt;td&gt;Header: &lt;/td&gt;</span>

<span class="x">      &lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;csv_header&quot;  </span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;csv_header&#39;</span><span class="p">]))</span> <span class="p">;</span> <span class="k">else</span> <span class="k">echo</span> <span class="s1">&#39;checked&#39;</span> <span class="cp">?&gt;</span><span class="x">/&gt;&lt;/td&gt;</span>

<span class="x">    &lt;/tr&gt;</span>

<span class="x">&lt;/table&gt;</span>





<span class="x">&lt;input type=&quot;submit&quot; name=&quot;action&quot;  value=&quot;Export&quot;&gt;&lt;br /&gt;</span>

<span class="x">&lt;/form&gt;</span>

<span class="x">&lt;/body&gt;</span>

<span class="x">&lt;/html&gt;</span>



<span class="cp">&lt;?php</span>

<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>