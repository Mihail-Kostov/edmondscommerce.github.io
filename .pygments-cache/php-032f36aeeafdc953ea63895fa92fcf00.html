<div class="highlight"><pre><span class="sd">/**</span>
<span class="sd">     * Generate a nice unique block cache key</span>
<span class="sd">     *</span>
<span class="sd">     * @param Mage_Core_Block_Abstract $block</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">ecCacheKey</span><span class="p">(</span><span class="nx">Mage_Core_Block_Abstract</span> <span class="nv">$block</span><span class="p">){</span>
        <span class="nv">$class</span> <span class="o">=</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$block</span><span class="p">);</span>
        <span class="nv">$template</span> <span class="o">=</span> <span class="nv">$block</span><span class="o">-&gt;</span><span class="na">getTemplateFile</span><span class="p">();</span>
        <span class="nv">$md5</span> <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span><span class="nb">var_export</span><span class="p">(</span><span class="nv">$block</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">(),</span> <span class="k">true</span><span class="p">));</span>
        <span class="nv">$params</span> <span class="o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nb">implode</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="nv">$block</span><span class="o">-&gt;</span><span class="na">getRequest</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getParams</span><span class="p">()),</span> <span class="s1">&#39;,&#39;</span><span class="p">);</span>
        <span class="nv">$category</span><span class="o">=</span><span class="p">(</span><span class="nv">$block</span><span class="o">-&gt;</span><span class="na">getCurrentCategory</span><span class="p">())</span><span class="o">?</span><span class="nv">$block</span><span class="o">-&gt;</span><span class="na">getCurrentCategory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()</span><span class="o">:</span><span class="s1">&#39;no-category&#39;</span><span class="p">;</span>
        <span class="nv">$store_id</span> <span class="o">=</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getStore</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">();</span>
        <span class="k">return</span> <span class="s1">&#39;edmondscommerce-&#39;</span><span class="o">.</span> <span class="nv">$params</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span> <span class="nv">$category</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nv">$store_id</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nv">$class</span><span class="o">.</span><span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="nv">$template</span><span class="o">.</span><span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="nv">$md5</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>