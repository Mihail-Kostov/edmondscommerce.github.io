<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>

<span class="cm">/* recursively delete all php files that are numeric titles, then edit all htaccess files and remove the 404 message */</span>

<span class="nv">$directory</span><span class="o">=</span><span class="nb">getcwd</span><span class="p">();</span>

<span class="nv">$dirs</span> <span class="o">=</span> <span class="nx">dir_list</span><span class="p">(</span><span class="nb">getcwd</span><span class="p">());</span>

<span class="nx">clean</span><span class="p">(</span><span class="nv">$dirs</span><span class="p">,</span> <span class="nv">$directory</span><span class="p">);</span>

<span class="k">function</span> <span class="nf">clean</span><span class="p">(</span><span class="nv">$dirs</span><span class="p">,</span> <span class="nv">$directory</span><span class="p">){</span>	
	<span class="k">foreach</span><span class="p">(</span><span class="nv">$dirs</span> <span class="k">as</span> <span class="nv">$k</span><span class="o">=&gt;</span><span class="nv">$v</span><span class="p">){</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$v</span><span class="p">)){</span>
			<span class="nx">clean</span><span class="p">(</span><span class="nv">$v</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">$directory</span><span class="s2">/</span><span class="si">$k</span><span class="s2">&quot;</span><span class="p">);</span>
		<span class="p">}</span><span class="k">else</span><span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;%^([0-9]+?)\.php$%&#39;</span><span class="p">,</span> <span class="nv">$v</span><span class="p">)){</span>
				<span class="k">echo</span> <span class="s1">&#39;&lt;h3&gt;Cleaning: &#39;</span><span class="o">.</span><span class="nv">$directory</span><span class="o">.</span><span class="s1">&#39;&lt;/h3&gt;&#39;</span><span class="p">;</span>
				<span class="k">echo</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="o">.</span><span class="nv">$v</span><span class="p">;</span>
				<span class="k">echo</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="o">.</span><span class="nv">$directory</span><span class="o">.</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
				<span class="nv">$htaccess</span><span class="o">=</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$directory</span><span class="s2">/.htaccess&quot;</span><span class="p">);</span>
				<span class="nv">$pattern</span> <span class="o">=</span> <span class="s1">&#39;%ErrorDocument(.+?)([0-9]+?)\.php$%&#39;</span><span class="p">;</span>
				<span class="nv">$clean_ht</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$htaccess</span><span class="p">);</span>
				<span class="nb">unlink</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$directory</span><span class="s2">/.htaccess&quot;</span><span class="p">);</span>
				<span class="nb">file_put_contents</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$directory</span><span class="s2">/.htaccess&quot;</span><span class="p">,</span> <span class="nv">$clean_ht</span><span class="p">);</span>
				<span class="nb">unlink</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$directory</span><span class="s2">/</span><span class="si">$v</span><span class="s2">&quot;</span><span class="p">);</span>
				<span class="k">echo</span> <span class="s1">&#39;&lt;h3&gt;Cleaned: &#39;</span><span class="o">.</span><span class="nv">$directory</span><span class="o">.</span><span class="s1">&#39;&lt;/h3&gt;&#39;</span><span class="p">;</span>				
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="k">function</span> <span class="nf">dir_list</span><span class="p">(</span><span class="nv">$directory</span><span class="p">,</span> <span class="nv">$ext</span><span class="o">=</span><span class="k">false</span><span class="p">){</span>
	<span class="c1">//echo $directory;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$handle</span> <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$directory</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="k">false</span> <span class="o">!==</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">=</span> <span class="nb">readdir</span><span class="p">(</span><span class="nv">$handle</span><span class="p">)))</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="nv">$file</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$file</span> <span class="o">!=</span> <span class="s1">&#39;..&#39;</span><span class="p">){</span>
				<span class="k">if</span><span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$directory</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$file</span><span class="p">)){</span>
					<span class="nv">$return</span><span class="p">[</span><span class="nv">$file</span><span class="p">]</span><span class="o">=</span><span class="nx">dir_list</span><span class="p">(</span><span class="nv">$directory</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$ext</span><span class="p">);</span>			
				<span class="p">}</span><span class="k">elseif</span><span class="p">(</span><span class="nv">$ext</span> <span class="o">!=</span> <span class="k">false</span><span class="p">){</span>
					<span class="k">if</span><span class="p">(</span><span class="nv">$ext</span> <span class="o">==</span> <span class="nx">file_ext</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
						<span class="nv">$return</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span>
					<span class="p">}</span>			
				<span class="p">}</span><span class="k">else</span><span class="p">{</span>
					<span class="nv">$return</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="nb">closedir</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
		<span class="k">return</span> <span class="nv">$return</span><span class="p">;</span>
	<span class="p">}</span><span class="k">else</span><span class="p">{</span>		
		<span class="k">echo</span> <span class="s1">&#39;&lt;h3 style=&quot;color: red;&quot;&gt;Error opening directory &#39;</span> <span class="o">.</span> <span class="nv">$directory</span> <span class="o">.</span> <span class="s1">&#39;&lt;/h3&gt;&#39;</span><span class="p">;</span>
		<span class="k">return</span> <span class="k">false</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></div>