<div class="highlight"><pre><span class="k">function</span> <span class="nf">email_attachment</span><span class="p">(</span><span class="nv">$to_email</span><span class="p">,</span> <span class="nv">$email</span><span class="p">,</span> <span class="nv">$subject</span><span class="p">,</span><span class="nv">$our_email_name</span><span class="p">,</span> <span class="nv">$our_email</span><span class="p">,</span> <span class="nv">$file_location</span><span class="p">,</span> <span class="nv">$default_filetype</span><span class="o">=</span><span class="s1">&#39;application/zip&#39;</span><span class="p">){</span>
	<span class="nv">$email</span> <span class="o">=</span> <span class="s1">&#39;&lt;font face=&quot;arial&quot;&gt;&#39;</span> <span class="o">.</span> <span class="nv">$email</span> <span class="o">.</span> <span class="s1">&#39;&lt;/font&gt;&#39;</span><span class="p">;</span>
	<span class="nv">$fileatt</span> <span class="o">=</span> <span class="nv">$file_location</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="nb">mime_content_type</span><span class="p">)){</span>
		<span class="nv">$fileatttype</span> <span class="o">=</span> <span class="nb">mime_content_type</span><span class="p">(</span><span class="nv">$file_location</span><span class="p">);</span> 
	<span class="p">}</span><span class="k">else</span><span class="p">{</span>
		<span class="nv">$fileatttype</span> <span class="o">=</span> <span class="nv">$default_filetype</span><span class="p">;;</span>
	<span class="p">}</span>
	<span class="nv">$fileattname</span> <span class="o">=</span><span class="nb">basename</span><span class="p">(</span><span class="nv">$file_location</span><span class="p">);</span>
	<span class="c1">//prepare attachment</span>
	<span class="nv">$file</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span> <span class="nv">$fileatt</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span> <span class="p">);</span> 
	<span class="nv">$data</span> <span class="o">=</span> <span class="nb">fread</span><span class="p">(</span> <span class="nv">$file</span><span class="p">,</span> <span class="nb">filesize</span><span class="p">(</span> <span class="nv">$fileatt</span> <span class="p">)</span> <span class="p">);</span> 
	<span class="nb">fclose</span><span class="p">(</span> <span class="nv">$file</span> <span class="p">);</span>
	<span class="nv">$data</span> <span class="o">=</span> <span class="nb">chunk_split</span><span class="p">(</span> <span class="nb">base64_encode</span><span class="p">(</span> <span class="nv">$data</span> <span class="p">)</span> <span class="p">);</span>
	<span class="c1">//create mime boundary</span>
	<span class="nv">$semi_rand</span> <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span> <span class="nb">time</span><span class="p">()</span> <span class="p">);</span> 
	<span class="nv">$mime_boundary</span> <span class="o">=</span> <span class="s2">&quot;==Multipart_Boundary_x</span><span class="si">{</span><span class="nv">$semi_rand</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">;</span> 
	<span class="c1">//create email  section</span>
	<span class="nv">$message</span> <span class="o">=</span> <span class="s2">&quot;This is a multi-part message in MIME format.</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">.</span> 
	<span class="s2">&quot;--</span><span class="si">{</span><span class="nv">$mime_boundary</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">.</span> 
	<span class="s2">&quot;Content-type: text/html; charset=us-ascii</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">.</span> 
	<span class="s2">&quot;Content-Transfer-Encoding: 7bit</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">.</span> 
	<span class="nv">$email</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">;</span>
	 <span class="c1">//create attachment section</span>
	<span class="nv">$message</span> <span class="o">.=</span> <span class="s2">&quot;--</span><span class="si">{</span><span class="nv">$mime_boundary</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">.</span> 
	 <span class="s2">&quot;Content-Type: </span><span class="si">{</span><span class="nv">$fileatttype</span><span class="si">}</span><span class="s2">;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">.</span> 
	 <span class="s2">&quot; name=</span><span class="se">\&quot;</span><span class="si">{</span><span class="nv">$fileattname</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span> <span class="o">.</span> 
	 <span class="s2">&quot;Content-Disposition: attachment;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">.</span> 
	 <span class="s2">&quot; filename=</span><span class="se">\&quot;</span><span class="si">{</span><span class="nv">$fileattname</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span> <span class="o">.</span> 
	 <span class="s2">&quot;Content-Transfer-Encoding: base64</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">.</span> 
	 <span class="nv">$data</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">.</span> 
	 <span class="s2">&quot;--</span><span class="si">{</span><span class="nv">$mime_boundary</span><span class="si">}</span><span class="s2">--</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
	 <span class="c1">//headers</span>
	<span class="nv">$exp</span><span class="o">=</span><span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="nv">$our_email</span><span class="p">);</span>
	<span class="nv">$domain</span> <span class="o">=</span> <span class="nv">$exp</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="nv">$headers</span> <span class="o">=</span> <span class="s2">&quot;From: </span><span class="si">$our_email_name</span><span class="s2">&lt;</span><span class="si">$our_email</span><span class="s2">&gt;&quot;</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
	<span class="nv">$headers</span> <span class="o">.=</span> <span class="s2">&quot;Reply-To: </span><span class="si">$our_email</span><span class="s2">&quot;</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
	<span class="nv">$headers</span> <span class="o">.=</span> <span class="s2">&quot;Return-Path: </span><span class="si">$our_email</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>    <span class="c1">// these two to set reply address</span>
	<span class="nv">$headers</span> <span class="o">.=</span> <span class="s2">&quot;Message-ID: &lt;&quot;</span><span class="o">.</span><span class="nb">time</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;@&quot;</span> <span class="o">.</span> <span class="nv">$domain</span> <span class="o">.</span> <span class="s2">&quot;&gt;&quot;</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
	<span class="nv">$headers</span> <span class="o">.=</span> <span class="s2">&quot;X-Mailer: Edmonds Commerce Email Attachment Function&quot;</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>          <span class="c1">// These two to help avoid spam-filters</span>
	<span class="nv">$headers</span> <span class="o">.=</span> <span class="s2">&quot;Date: &quot;</span><span class="o">.</span><span class="nb">date</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
	<span class="nv">$headers</span> <span class="o">.=</span> <span class="s2">&quot;MIME-Version: 1.0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">.</span> 
                    <span class="s2">&quot;Content-Type: multipart/mixed;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">.</span> 
                    <span class="s2">&quot; boundary=</span><span class="se">\&quot;</span><span class="si">{</span><span class="nv">$mime_boundary</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">;</span>
	 
	<span class="nb">mail</span><span class="p">(</span><span class="nv">$to_email</span><span class="p">,</span><span class="nv">$subject</span><span class="p">,</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$headers</span><span class="p">,</span> <span class="s1">&#39;-f &#39;</span> <span class="o">.</span> <span class="nv">$our_email</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span> <span class="p">(</span><span class="s1">&#39;&lt;h3 style=&quot;color: red;&quot;&gt;Mail Failed&lt;/h3&gt;&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>