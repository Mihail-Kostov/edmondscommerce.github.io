<div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">createCategory</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$store_id</span><span class="p">,</span> <span class="nv">$parent_id</span><span class="p">,</span> <span class="nv">$active</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$anchor</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$display_mode</span><span class="o">=</span><span class="s1">&#39;PRODUCTS&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$parent</span> <span class="o">=</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">getModel</span><span class="p">(</span><span class="s1">&#39;catalog/category&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="nv">$parent_id</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$parent</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">()</span> <span class="o">!=</span> <span class="nv">$parent_id</span><span class="p">){</span>
            <span class="nx">Mage</span><span class="o">::</span><span class="na">helper</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">except</span><span class="p">(</span><span class="s1">&#39;Failed to load parent category&#39;</span><span class="p">,</span> <span class="s1">&#39;Fatal&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$category</span> <span class="o">=</span> <span class="nx">Mage</span><span class="o">::</span><span class="na">getModel</span><span class="p">(</span><span class="s1">&#39;catalog/category&#39;</span><span class="p">);</span>
        <span class="cm">/* @var $category Mage_Catalog_Model_Category */</span>
        <span class="nv">$category</span>
                <span class="o">-&gt;</span><span class="na">setStoreId</span><span class="p">(</span><span class="nv">$store_id</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">setPath</span><span class="p">(</span><span class="nv">$parent</span><span class="o">-&gt;</span><span class="na">getPath</span><span class="p">())</span>
                <span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">setUrlKey</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">setIsActive</span><span class="p">(</span><span class="nv">$active</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">setIsAnchor</span><span class="p">(</span><span class="nv">$anchor</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">setDisplayMode</span><span class="p">(</span><span class="nv">$display_mode</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">setAttributeSetId</span><span class="p">(</span><span class="nv">$category</span><span class="o">-&gt;</span><span class="na">getDefaultAttributeSetId</span><span class="p">())</span>
        <span class="p">;</span>
        <span class="nv">$category</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
        <span class="k">return</span> <span class="nv">$category</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>