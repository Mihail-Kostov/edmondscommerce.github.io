<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/DataPump.php&#39;</span><span class="p">;</span>
<span class="sd">/**</span>
<span class="sd"> * These are required to ensure that the PDO object in the class is able to work correctly</span>
<span class="sd"> * @backupGlobals disabled</span>
<span class="sd"> * @backupStaticAttributes disabled</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">DataPumpTest</span> <span class="k">extends</span> <span class="nx">PHPUnit_Extensions_Database_TestCase</span>
<span class="p">{</span>

<span class="err"> </span> <span class="err"> </span> <span class="sd">/**</span>
<span class="sd">     * This is the object that will be tested</span>
<span class="sd">     * @var DataPump</span>
<span class="sd">     */</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">protected</span> <span class="nv">$object</span><span class="p">;</span>
<span class="err"> </span> <span class="err">  </span>
<span class="err"> </span> <span class="err"> </span> <span class="sd">/**</span>
<span class="sd">     * only instantiate pdo once for test clean-up/fixture load</span>
<span class="sd">     * @var PDO</span>
<span class="sd">     */</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">static</span> <span class="k">private</span> <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

<span class="err"> </span> <span class="err"> </span> <span class="sd">/**</span>
<span class="sd">     * only instantiate PHPUnit_Extensions_Database_DB_IDatabaseConnection once per test</span>
<span class="sd">     * @var type </span>
<span class="sd">     */</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">private</span> <span class="nv">$conn</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

<span class="err"> </span> <span class="err"> </span> <span class="sd">/**</span>
<span class="sd">     * Sets up the fixture, for example, opens a network connection.</span>
<span class="sd">     * This method is called before a test is executed.</span>
<span class="sd">     */</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DataPump</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="sd">/**</span>
<span class="sd">     * Tears down the fixture, for example, closes a network connection.</span>
<span class="sd">     * This method is called after a test is executed.</span>
<span class="sd">     */</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">protected</span> <span class="k">function</span> <span class="nf">tearDown</span><span class="p">()</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err">  </span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span>
<span class="err"> </span> <span class="err">  </span>
<span class="err"> </span> <span class="err"> </span> <span class="k">protected</span> <span class="k">function</span> <span class="nf">getConnection</span><span class="p">()</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">conn</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$pdo</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nx">self</span><span class="o">::</span><span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:dbname=testing_database;host=localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;dbUserName&#39;</span><span class="p">,</span> <span class="s1">&#39;dbPassword&#39;</span><span class="p">);;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="p">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">conn</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createDefaultDBConnection</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$pdo</span><span class="p">,</span> <span class="s1">&#39;ross_testing&#39;</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="p">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">conn</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="k">protected</span> <span class="k">function</span> <span class="nf">getDataSet</span><span class="p">()</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMySQLXMLDataSet</span><span class="p">(</span><span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/datapump.xml&#39;</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="sd">/**</span>
<span class="sd">     * This is here to ensure that the database is working correctly</span>
<span class="sd">     */</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">public</span> <span class="k">function</span> <span class="nf">testDataBaseConnection</span><span class="p">()</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err">  </span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createDataSet</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">));</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nv">$prod</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getDataSet</span><span class="p">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nv">$queryTable</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createQueryTable</span><span class="p">(</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="s1">&#39;SELECT * FROM products&#39;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nv">$expectedTable</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getDataSet</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getTable</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">);</span>
        <span class="c1">//Here we check that the table in the database matches the data in the XML file</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTablesEqual</span><span class="p">(</span><span class="nv">$expectedTable</span><span class="p">,</span> <span class="nv">$queryTable</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span>
    <span class="sd">/**</span>
<span class="sd">     * This is where you can put your actual tests</span>
<span class="sd">     */</span>
<span class="p">}</span>
</pre></div>