<div class="highlight"><pre><span class="cm">/*Create  Directory Tree if Not Exists</span>
<span class="cm">If you are passing a path with a filename on the end, pass true as the second parameter to snip it off */</span>
<span class="k">function</span> <span class="nf">make_path</span><span class="p">(</span><span class="nv">$pathname</span><span class="p">,</span> <span class="nv">$is_filename</span><span class="o">=</span><span class="k">false</span><span class="p">){</span>

	<span class="k">if</span><span class="p">(</span><span class="nv">$is_filename</span><span class="p">){</span>

		<span class="nv">$pathname</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$pathname</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">strrpos</span><span class="p">(</span><span class="nv">$pathname</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">));</span>

	<span class="p">}</span>

    <span class="c1">// Check if directory already exists</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$pathname</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$pathname</span><span class="p">))</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>

    <span class="p">}</span> 

    <span class="c1">// Ensure a file does not already exist with the same name</span>

    <span class="nv">$pathname</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;\\&#39;</span><span class="p">),</span> <span class="nx">DIRECTORY_SEPARATOR</span><span class="p">,</span> <span class="nv">$pathname</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$pathname</span><span class="p">))</span> <span class="p">{</span>

        <span class="nb">trigger_error</span><span class="p">(</span><span class="s1">&#39;mkdirr() File exists&#39;</span><span class="p">,</span> <span class="nx">E_USER_WARNING</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>

    <span class="p">}</span> 

    <span class="c1">// Crawl up the directory tree</span>

    <span class="nv">$next_pathname</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$pathname</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">strrpos</span><span class="p">(</span><span class="nv">$pathname</span><span class="p">,</span> <span class="nx">DIRECTORY_SEPARATOR</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">make_path</span><span class="p">(</span><span class="nv">$next_pathname</span><span class="p">,</span> <span class="nv">$mode</span><span class="p">))</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$pathname</span><span class="p">))</span> <span class="p">{</span>

            <span class="k">return</span> <span class="nb">mkdir</span><span class="p">(</span><span class="nv">$pathname</span><span class="p">,</span> <span class="nv">$mode</span><span class="p">);</span>

        <span class="p">}</span>

    <span class="p">}</span> 

    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>