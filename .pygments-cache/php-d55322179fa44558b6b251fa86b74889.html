<div class="highlight"><pre><span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Pragma: public&quot;</span><span class="p">);</span>
<span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Expires: 0&quot;</span><span class="p">);</span>
<span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Cache-Control: must-revalidate, post-check=0, pre-check=0&quot;</span><span class="p">);</span>
<span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Cache-Control: private&quot;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Content-Type: application/octet-stream&quot;</span><span class="p">);</span>
<span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Content-Disposition: attachment; filename=</span><span class="se">\&quot;</span><span class="s2">file.csv</span><span class="se">\&quot;</span><span class="s2">;&quot;</span><span class="p">);</span>
<span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Content-Transfer-Encoding: binary&quot;</span><span class="p">);</span>

<span class="nv">$outstream</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s2">&quot;php://output&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">);</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot; select * from a_table&quot;</span><span class="p">;</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nx">db_query</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$sql</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="nv">$header</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$r</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$q</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$header</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">fputcsv</span><span class="p">(</span><span class="nv">$outstream</span><span class="p">,</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nv">$r</span><span class="p">));</span>
        <span class="nv">$header</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nb">fputcsv</span><span class="p">(</span><span class="nv">$outstream</span><span class="p">,</span> <span class="nv">$r</span><span class="p">);</span>
<span class="p">}</span>
<span class="nb">fclose</span><span class="p">(</span><span class="nv">$outstream</span><span class="p">);</span>
</pre></div>