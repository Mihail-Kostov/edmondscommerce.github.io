<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Magento Security Patch Script &middot; </title>

  
  <link rel="stylesheet" href="https://edmondscommerce.github.io/css/poole.css">
  <link rel="stylesheet" href="https://edmondscommerce.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://edmondscommerce.github.io/css/poole-overrides.css">
  <link rel="stylesheet" href="https://edmondscommerce.github.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="https://edmondscommerce.github.io/css/hyde-x.css">
  <link rel="stylesheet" href="https://edmondscommerce.github.io/css/highlight/github.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link href="https://edmondscommerce.github.io/favicon.ico" rel="icon">

  
  
  
  

  <meta name="description" content="">
  <meta name="keywords" content="">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'google analytics', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
        <a href="/"><img src="/images/eclogo.png"
             alt="gravatar" title="">
        </a>
      
      <h1></h1>
      
    </div>
    <p>
      <a href="http://www.edmondscommerce.co.uk">Edmonds Commerce</a> are a UK based E-Commerce web development
      agency. We are based in <a href="http://www.yorkshire.com/">Yorkshire</a> near <a href="http://www.visitleeds.co.uk/">Leeds</a> and <a href="http://www.visitbradford.com/">Bradford</a>.
    </p>

    <p>
      Our primary specialism is <a href="http://magento.com/">Magento</a> and other PHP based E-Commerce platforms
      such as <a href="http://www.opencart.com/">OpenCart</a>.
    </p>

    <p>
      In terms of technology we are very strong in <a href="http://php.net/">PHP</a>, <a href="http://www.mysql.com/">MySQL</a>, <a href="http://www.linuxfoundation.org/">Linux</a>,
      <a href="http://www.w3.org/standards/techs/html#w3c_all">HTML</a><a>, <a href="http://www.w3.org/Style/CSS/Overview.en.html">CSS</a> and <a href="http://en.wikipedia.org/wiki/JavaScript">Javascript</a>.</li>
  </ul>


    <ul class="sidebar-nav">
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/edmondscommerce"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      <a href="https://www.linkedin.com/company/edmonds-commerce"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="https://plus.google.com/104488822194646220248?rel=author"><i class="fa fa-google-plus-square fa-3x"></i></a>
      
      <a href="https://twitter.com/edmondscommerce"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      <a href="https://edmondscommerce.github.io/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
      <p>
        <a href="mailto:info@edmondscommerce.co.uk">info@edmondscommerce.co.uk</a><br>
        <a href="tel:00441138805654">0044 113 880 5654</a>
      </p>
    </ul>

    

  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">Magento Security Patch Script</h1>
    <span class="post-date">Jul 10, 2012 &middot; 3 minute read
    
    <br/>
      <strong>Category: </strong>
    <a class="label" href="https://edmondscommerce.github.io/categories/magento">magento</a>
    </span>
    <p>We are currently offering a free service to apply the security patches for any Magento store. <a href="http://www.edmondscommerce.co.uk/magento/magento-security-vulnerability-free-assistance/">You can read all about that here</a>.</p>

<p>For those of you who are comfortable SSHing into your server and running things manually but would like this to be as easy as possible, you can use our bash script to automatically determine which Magento security patch you require and then apply it.</p>

<p>Simply run the following command:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>wget -qO- http://www.edmondscommerce.co.uk/stuff/applysecuritypatch.sh <span class="p">|</span> /bin/sh
</code></pre></div>

<p>For information, this is the source of the above file.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="ch">#!/bin/bash</span>

<span class="k">if</span> <span class="o">[</span> ! -f app/Mage.php <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Not in the magento basedir. please run from public_html, httpdocs, www or wherever index.php is.&quot;</span>
  <span class="nb">exit</span> 99
<span class="k">fi</span>

<span class="nv">WGET_BINARY</span><span class="o">=</span><span class="k">$(</span>which wget<span class="k">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;&quot;</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="nv">$WGET_BINARY</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Can&#39;t find wget in path... can&#39;t continue&quot;</span>
  <span class="nb">exit</span> 98
<span class="k">fi</span>

<span class="nv">MAGENTO_VERSION</span><span class="o">=</span><span class="k">$(</span>grep <span class="s1">&#39;function getVersionInfo\(\)&#39;</span> -A6 app/Mage.php <span class="p">|</span> sed s/<span class="o">[</span>^0-9<span class="o">]</span>//g <span class="p">|</span> tr <span class="s1">&#39;\n&#39;</span> <span class="s1">&#39;.&#39;</span> <span class="p">|</span> sed s/<span class="s1">&#39;\.\.*&#39;</span>// <span class="p">|</span> sed s/<span class="s1">&#39;\.$&#39;</span>//<span class="k">)</span>
<span class="nb">echo</span> <span class="s2">&quot;Your Magento version is </span><span class="nv">$MAGENTO_VERSION</span><span class="s2">&quot;</span>

<span class="nb">export</span> <span class="k">$(</span>grep <span class="s1">&#39;function getVersionInfo()&#39;</span> -A6 app/Mage.php <span class="p">|</span> <span class="nv">grep</span> <span class="o">=</span> <span class="p">|</span> sed s/,// <span class="p">|</span> sed s/<span class="se">\&gt;</span>// <span class="p">|</span> sed s/<span class="s1">&#39;[\t ]&#39;</span>//g <span class="p">|</span> tr <span class="s2">&quot;a-z&quot;</span> <span class="s2">&quot;A-Z&quot;</span> <span class="p">|</span> sed s/^/MAGENTO_/ <span class="p">|</span> sed s/<span class="s2">&quot;&#39;&quot;</span>//g<span class="k">)</span>

<span class="nb">set</span> <span class="p">|</span> grep MAGENTO

<span class="c1">#</span>
<span class="c1">#Community Edition 1.4.0.0 through 1.4.1.1 http://www.magentocommerce.com/downloads/assets/1.7.0.2/CE_1.4.0.0-1.4.1.1.patch</span>
<span class="c1">#Community Edition 1.4.2.0 http://www.magentocommerce.com/downloads/assets/1.7.0.2/CE_1.4.2.0.patch</span>
<span class="c1">#Community Edition 1.5.0.0 through 1.7.0.1 http://www.magentocommerce.com/downloads/assets/1.7.0.2/CE_1.5.0.0-1.7.0.1.patch</span>
<span class="c1">#</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$MAGENTO_MAJOR</span><span class="s2">&quot;</span> -eq <span class="s2">&quot;1&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$MAGENTO_MINOR</span><span class="s2">&quot;</span> -eq <span class="s2">&quot;4&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$MAGENTO_PATCH</span> -lt <span class="s2">&quot;2&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    	<span class="nv">CORRECT_PATCH</span><span class="o">=</span><span class="s1">&#39;http://www.magentocommerce.com/downloads/assets/1.7.0.2/CE_1.4.0.0-1.4.1.1.patch&#39;</span>
      <span class="nb">echo</span> <span class="s2">&quot;Running Magento &lt; 1.4.2.0 - patch is </span><span class="nv">$CORRECT_PATCH</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="nv">CORRECT_PATCH</span><span class="o">=</span><span class="s1">&#39;http://www.magentocommerce.com/downloads/assets/1.7.0.2/CE_1.4.2.0.patch&#39;</span>
      <span class="nb">echo</span> <span class="s2">&quot;Running Magento 1.4.2.0 - patch is </span><span class="nv">$CORRECT_PATCH</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">fi</span>
  <span class="k">elif</span> <span class="o">[</span> <span class="nv">$MAGENTO_MINOR</span> -gt <span class="s2">&quot;4&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$MAGENTO_MINOR</span> -lt <span class="s2">&quot;7&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
      <span class="nv">CORRECT_PATCH</span><span class="o">=</span><span class="s1">&#39;http://www.magentocommerce.com/downloads/assets/1.7.0.2/CE_1.5.0.0-1.7.0.1.patch&#39;</span>
      <span class="nb">echo</span> <span class="s2">&quot;Running Magento 1.5.0.0 or above - patch is </span><span class="nv">$CORRECT_PATCH</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">elif</span> <span class="o">[</span> <span class="nv">$MAGENTO_MINOR</span> -eq <span class="s2">&quot;7&quot;</span> -a <span class="nv">$MAGENTO_PATCH</span> -eq <span class="s2">&quot;0&quot;</span> -a <span class="nv">$MAGENTO_REVISION</span> -lt <span class="s2">&quot;2&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
      <span class="nv">CORRECT_PATCH</span><span class="o">=</span><span class="s1">&#39;http://www.magentocommerce.com/downloads/assets/1.7.0.2/CE_1.5.0.0-1.7.0.1.patch&#39;</span>
      <span class="nb">echo</span> <span class="s2">&quot;Running Magento 1.5.0.0 or above - patch is </span><span class="nv">$CORRECT_PATCH</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="nb">echo</span> <span class="s2">&quot;Running Magento 1.7.0.2 - already patched.&quot;</span>
      <span class="nb">exit</span> 1
    <span class="k">fi</span>
  <span class="k">fi</span>
<span class="k">else</span> 
  <span class="nb">echo</span> <span class="s2">&quot;You&#39;re not running version 1.x.x.x of Magento, I have no idea what to do!&quot;</span>
  <span class="nb">exit</span> 97
<span class="k">fi</span> 

wget -O - <span class="nv">$CORRECT_PATCH</span> 2&gt; /dev/null <span class="p">|</span> patch -p0
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Patch succeeded.&quot;</span>
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">&quot;For some reason the patch failed.  See the output above.&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;You could attempt to download the patch manually and apply it - the url is :- &quot;</span>
  <span class="nb">echo</span> <span class="nv">$CORRECT_PATCH</span>
<span class="k">fi</span>
</code></pre></div>

<p>Please note this script is supplied without any warranty, use at your own risk. We are not supplying the patch files simply making it easy to download and apply the correct one.</p>

<p>We strongly recommend you patch your store as soon as possible.</p>

<p><b><a href="http://www.edmondscommerce.co.uk/contact-us/?about=Free+Magento+Security+Fix"> If you need help, just ask!</a></b></p>

  </div>
  
  <br/>
  <strong>Tags: </strong>
  <a class="label" href="https://edmondscommerce.github.io/tags/security">security</a><a class="label" href="https://edmondscommerce.github.io/tags/bug">bug</a><a class="label" href="https://edmondscommerce.github.io/tags/magento">magento</a><a class="label" href="https://edmondscommerce.github.io/tags/tool">tool</a><a class="label" href="https://edmondscommerce.github.io/tags/zend">zend</a><a class="label" href="https://edmondscommerce.github.io/tags/framework">framework</a><a class="label" href="https://edmondscommerce.github.io/tags/script">script</a><a class="label" href="https://edmondscommerce.github.io/tags/fix">fix</a><a class="label" href="https://edmondscommerce.github.io/tags/free">free</a><a class="label" href="https://edmondscommerce.github.io/tags/patch">patch</a><a class="label" href="https://edmondscommerce.github.io/tags/offer">offer</a>
  
  
</div>




<script src="https://edmondscommerce.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

