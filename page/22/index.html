<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Edmonds Commerce Dev Blog</title>
  <meta name="author" content="EdmondsCommerce Development Team">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://edmondscommerce.github.io/page/22">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Edmonds Commerce Dev Blog" type="application/atom+xml">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-27853727-2', 'edmondscommerce.github.io');
  ga('send', 'pageview');

</script>

</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img height="20" src="https://2.gravatar.com/avatar/04b807394911b26ea8a79dbe25ea4e1a?d=https%3A%2F%2Fidenticons.github.com%2Fccb745f4b144d30c4b883330a1114834.png&amp;r=x&amp;s=140" width="20"> Dev Blog</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
                
                <li ><a href="/categories/index.html">Categories</a></li>
                
                <li ><a href="/contact-us/index.html">Contact</a></li>
                
            </ul>
            <ul class="nav pull-right">
                
                
                <li><a href="http://linkedin.com/in/edmondscommerce" title="Linkedin Profile"><i class="icon-linkedin-sign social-navbar"></i></a></li>
                
                
                
                <li><a href="http://plus.google.com/104488822194646220248" title="Google+ Profile"><i class="icon-google-plus-sign social-navbar"></i></a></li>
                
                
                
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:edmondscommerce.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <div class="blog-index">
      
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-08-16T15:45:56+01:00" pubdate data-updated="true">Aug 16<span>th</span>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/bash/format-searched-log-files.html">Format Searched Log Files</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>When you are monitoring a log file you may want to narrow it down, and format the results. This simple one line command will break up the output from a log file to make it easier to quickly read</p>

<p><code>
tail -f /path/to/log | grep &ldquo;search term&rdquo; | sed &rsquo;s/(.*)/&mdash;&mdash;&mdash;&mdash;&mdash;\n\1\n&mdash;&mdash;&mdash;&mdash;&mdash;/&lsquo;
</code></p>
</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-08-15T14:17:17+01:00" pubdate data-updated="true">Aug 15<span>th</span>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/magento/get-all-product-attributes-for-a-magento-object-using-sql.html">Get All Product Attributes for a Magento Object Using SQL</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Sometimes you may want to quickly compare all of the attributes that object (category / product) has in magento. The EAV structure of the database makes this difficult to do this simply, so this is a query that will do it for you</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="p">(</span>
</span><span class='line'>    <span class="k">SELECT</span>
</span><span class='line'>        <span class="n">ce</span><span class="p">.</span><span class="n">sku</span><span class="p">,</span>
</span><span class='line'>        <span class="n">ea</span><span class="p">.</span><span class="n">attribute_id</span><span class="p">,</span>
</span><span class='line'>        <span class="n">ea</span><span class="p">.</span><span class="n">attribute_code</span><span class="p">,</span>
</span><span class='line'>        <span class="k">CASE</span> <span class="n">ea</span><span class="p">.</span><span class="n">backend_type</span>
</span><span class='line'>           <span class="k">WHEN</span> <span class="s1">&#39;varchar&#39;</span> <span class="k">THEN</span> <span class="n">ce_varchar</span><span class="p">.</span><span class="n">value</span>
</span><span class='line'>           <span class="k">WHEN</span> <span class="s1">&#39;int&#39;</span> <span class="k">THEN</span> <span class="n">ce_int</span><span class="p">.</span><span class="n">value</span>
</span><span class='line'>           <span class="k">WHEN</span> <span class="s1">&#39;text&#39;</span> <span class="k">THEN</span> <span class="n">ce_text</span><span class="p">.</span><span class="n">value</span>
</span><span class='line'>           <span class="k">WHEN</span> <span class="s1">&#39;decimal&#39;</span> <span class="k">THEN</span> <span class="n">ce_decimal</span><span class="p">.</span><span class="n">value</span>
</span><span class='line'>           <span class="k">WHEN</span> <span class="s1">&#39;datetime&#39;</span> <span class="k">THEN</span> <span class="n">ce_datetime</span><span class="p">.</span><span class="n">value</span>
</span><span class='line'>           <span class="k">ELSE</span> <span class="n">ea</span><span class="p">.</span><span class="n">backend_type</span>
</span><span class='line'>        <span class="k">END</span> <span class="k">AS</span> <span class="n">value</span><span class="p">,</span>
</span><span class='line'>        <span class="n">ea</span><span class="p">.</span><span class="n">is_required</span> <span class="k">AS</span> <span class="n">required</span>
</span><span class='line'>    <span class="k">FROM</span> <span class="n">catalog_product_entity</span> <span class="k">AS</span> <span class="n">ce</span>
</span><span class='line'>    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">eav_attribute</span> <span class="k">AS</span> <span class="n">ea</span>
</span><span class='line'>        <span class="k">ON</span> <span class="n">ce</span><span class="p">.</span><span class="n">entity_type_id</span> <span class="o">=</span> <span class="n">ea</span><span class="p">.</span><span class="n">entity_type_id</span>
</span><span class='line'>    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">catalog_product_entity_varchar</span> <span class="k">AS</span> <span class="n">ce_varchar</span>
</span><span class='line'>        <span class="k">ON</span> <span class="n">ce</span><span class="p">.</span><span class="n">entity_id</span> <span class="o">=</span> <span class="n">ce_varchar</span><span class="p">.</span><span class="n">entity_id</span>
</span><span class='line'>        <span class="k">AND</span> <span class="n">ea</span><span class="p">.</span><span class="n">attribute_id</span> <span class="o">=</span> <span class="n">ce_varchar</span><span class="p">.</span><span class="n">attribute_id</span>
</span><span class='line'>        <span class="k">AND</span> <span class="n">ea</span><span class="p">.</span><span class="n">backend_type</span> <span class="o">=</span> <span class="s1">&#39;varchar&#39;</span>
</span><span class='line'>    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">catalog_product_entity_int</span> <span class="k">AS</span> <span class="n">ce_int</span>
</span><span class='line'>        <span class="k">ON</span> <span class="n">ce</span><span class="p">.</span><span class="n">entity_id</span> <span class="o">=</span> <span class="n">ce_int</span><span class="p">.</span><span class="n">entity_id</span>
</span><span class='line'>        <span class="k">AND</span> <span class="n">ea</span><span class="p">.</span><span class="n">attribute_id</span> <span class="o">=</span> <span class="n">ce_int</span><span class="p">.</span><span class="n">attribute_id</span>
</span><span class='line'>        <span class="k">AND</span> <span class="n">ea</span><span class="p">.</span><span class="n">backend_type</span> <span class="o">=</span> <span class="s1">&#39;int&#39;</span>
</span><span class='line'>    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">catalog_product_entity_text</span> <span class="k">AS</span> <span class="n">ce_text</span>
</span><span class='line'>        <span class="k">ON</span> <span class="n">ce</span><span class="p">.</span><span class="n">entity_id</span> <span class="o">=</span> <span class="n">ce_text</span><span class="p">.</span><span class="n">entity_id</span>
</span><span class='line'>        <span class="k">AND</span> <span class="n">ea</span><span class="p">.</span><span class="n">attribute_id</span> <span class="o">=</span> <span class="n">ce_text</span><span class="p">.</span><span class="n">attribute_id</span>
</span><span class='line'>        <span class="k">AND</span> <span class="n">ea</span><span class="p">.</span><span class="n">backend_type</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</span><span class='line'>    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">catalog_product_entity_decimal</span> <span class="k">AS</span> <span class="n">ce_decimal</span>
</span><span class='line'>        <span class="k">ON</span> <span class="n">ce</span><span class="p">.</span><span class="n">entity_id</span> <span class="o">=</span> <span class="n">ce_decimal</span><span class="p">.</span><span class="n">entity_id</span>
</span><span class='line'>        <span class="k">AND</span> <span class="n">ea</span><span class="p">.</span><span class="n">attribute_id</span> <span class="o">=</span> <span class="n">ce_decimal</span><span class="p">.</span><span class="n">attribute_id</span>
</span><span class='line'>        <span class="k">AND</span> <span class="n">ea</span><span class="p">.</span><span class="n">backend_type</span> <span class="o">=</span> <span class="s1">&#39;decimal&#39;</span>
</span><span class='line'>    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">catalog_product_entity_datetime</span> <span class="k">AS</span> <span class="n">ce_datetime</span>
</span><span class='line'>        <span class="k">ON</span> <span class="n">ce</span><span class="p">.</span><span class="n">entity_id</span> <span class="o">=</span> <span class="n">ce_datetime</span><span class="p">.</span><span class="n">entity_id</span>
</span><span class='line'>        <span class="k">AND</span> <span class="n">ea</span><span class="p">.</span><span class="n">attribute_id</span> <span class="o">=</span> <span class="n">ce_datetime</span><span class="p">.</span><span class="n">attribute_id</span>
</span><span class='line'>        <span class="k">AND</span> <span class="n">ea</span><span class="p">.</span><span class="n">backend_type</span> <span class="o">=</span> <span class="s1">&#39;datetime&#39;</span>
</span><span class='line'>    <span class="k">WHERE</span> <span class="n">ce</span><span class="p">.</span><span class="n">sku</span> <span class="o">=</span> <span class="n">YOUR_SKU</span>
</span><span class='line'>  <span class="p">)</span> <span class="k">AS</span> <span class="n">tab</span>
</span><span class='line'>  <span class="k">WHERE</span> <span class="n">tab</span><span class="p">.</span><span class="n">value</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This version of the query will only return values that are not blank, but if you only run the sub query it will give you every value.
Replace catalog_product* for catalog_category to get the values for a category. You will also have to use a different selector than SKU.</p>
</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-08-15T14:16:16+01:00" pubdate data-updated="true">Aug 15<span>th</span>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/jquery/comply-with-the-cookie-law-with-very-little-effort.html">Comply With the Cookie Law With Very Little Effort</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>A lot of concern has been caused by the &ldquo;Cookie Law&rdquo; which says you must tell people that you use cookies if you do, and 99% of sites do!</p>

<p>Well here&rsquo;s a very simple jQuery bolt-on that deals with that, and although visitors need javascript enabled to see it, you have made &ldquo;best efforts&rdquo; to inform them, and on any eCommerce site you&rsquo;re going to have a &ldquo;this site requires javascript message&rdquo; anyway.</p>

<p>The file to download is from github (isn&rsquo;t opensource great?) <a href="https://github.com/carlwoodhouse/jquery.cookieBar" title="jQuery.cookiebar on github">here</a> and is as simple to implement as add the script file to the head and somewhere on the page insert the following :</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">.</span><span class="nx">cookieBar</span><span class="p">();</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The example page is also on github : <a href="http://carlwoodhouse.github.com/jquery.cookieBar/" title="CookieBar example page"><a href="http://carlwoodhouse.github.com/jquery.cookieBar/">http://carlwoodhouse.github.com/jquery.cookieBar/</a></a>.</p>
</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-08-15T12:58:23+01:00" pubdate data-updated="true">Aug 15<span>th</span>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/mysql/mysql-server-gone-away-large-packets-the-issue.html">MySQL Server Gone Away - Large Packets the Issue?</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>If you are scratching your head trying to figure out why you keep getting MySQL server gone away error messages despite the fact you have bumped up all the timeout etc configurations to high values then this could be your solution.</p>

<p>MySQL will also give you this error if you try to send a packet that is larger than the packet size defined. We had an application that was using MariaDB which has a default max allowed packet of 16M by default.</p>

<p>The application in question was sending large amounts of data to be stored and so the solution to the gone away issues was simply to increase the max_allowed_packet configuration in my.cnf, restart the mysql daemon and the problems are sorted.</p>
</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-08-14T17:33:31+01:00" pubdate data-updated="true">Aug 14<span>th</span>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/amazon/centos-sun-java-amazon-amtu-2.html">CentOS + Sun Java + Amazon AMTU 2</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>In a follow up to our popular blog post describing the process of getting AMTU 1 set up on a Centos server, this post describes how to get the latest version 2 of AMTU running.</p>

<p>Things have moved on and thankfully it is a lot easier than it was.</p>

<p>Firstly get Sun Java installed. You will need to get the URL for downloading the RPM from here:
<a href="http://www.oracle.com/technetwork/java/javase/downloads/jre7-downloads-1637588.html">http://www.oracle.com/technetwork/java/javase/downloads/jre7-downloads-1637588.html</a></p>

<p>Accept the agreement, download the correct RPM version and then pause it. Copy the download URL and paste it into this command:</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /tmp
</span><span class='line'>wget <span class="o">[</span>paste-url<span class="o">]</span>-here<span class="o">]</span>
</span><span class='line'>rpm - jre <span class="o">[</span>hit tab to <span class="nb">complete</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now check the correct java version is being used:</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>java -version
</span></code></pre></td></tr></table></div></figure>


<p>You should get something looking like:</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@94 tmp<span class="o">]</span><span class="c"># java -version</span>
</span><span class='line'>java version &amp;quot;1.7.0_05&amp;quot;
</span><span class='line'>Java<span class="o">(</span>TM<span class="o">)</span> SE Runtime Environment <span class="o">(</span>build 1.7.0_05-b06<span class="o">)</span>
</span><span class='line'>Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM <span class="o">(</span>build 23.1-b03, mixed mode<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now you can install AMTU</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget https://d28hcfptedr5ia.cloudfront.net/install/AMTU_unix.sh
</span><span class='line'>chmod +x AMTU_unix.sh
</span><span class='line'>./AMTU_unix.sh
</span></code></pre></td></tr></table></div></figure>


<p>Keep hitting enter to get to the bottom of the terms and then agree, agree to all the other options. That is AMTU installed.</p>

<p>The final step is to configure this using the CLI configure utitlity.</p>

<p>You need to create an xml file for the AMTU configuration. You can see a sample file in /opt/amtu/xml/sample.xml.</p>

<p>Lets copy that file and then edit it accordingly.</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /opt/amtu/xml
</span><span class='line'>cp sample.xml configuration.xml
</span><span class='line'>vim configuration.xml
</span></code></pre></td></tr></table></div></figure>


<p>You do need to be signed up for MWS to get some of the keys etc that are required. If not already, go to this page and hit the sign up button.
<a href="https://developer.amazonservices.co.uk/index.html">https://developer.amazonservices.co.uk/index.html</a></p>

<p>Once you have updated the XML configuration you run this command to apply it:</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/opt/amtu/Utilities/configure SETUP /opt/amtu/xml/configuration.xml
</span></code></pre></td></tr></table></div></figure>


<p>If you get some error messages at this point, edit the configuration and try again. Once you have the configuration set you can start the daemon.</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/opt/AMTU/Utilities/amtu_daemon start
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-08-14T16:03:11+01:00" pubdate data-updated="true">Aug 14<span>th</span>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/mysql/wondering-what-youre-waiting-for-mytop-tells-all.html">Wondering What You&#8217;re Waiting for? Mytop Tells All</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Mytop is a handy utility which shows what queries are currently being executed on your MySQL server &ndash; useful for those times when you&rsquo;re not quite sure if it&rsquo;s still on the job</p>

<p>Running mytop is easy, just run it from the command line and it&rsquo;ll give you a top-like list of any queries currently being executed on the server
You need to tell my top how it should connect to your database. You <em>can</em> specify everything as parameters on the command, such as</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mytop -u<span class="o">=</span>myuser -p<span class="o">=</span>mypassword --db<span class="o">=</span>mydatabase -P<span class="o">=</span>3306
</span></code></pre></td></tr></table></div></figure>


<p>But chances are you&rsquo;re not changing your database server <em>that</em> often.</p>

<h3>Setting the default parameters for mytop</h3>


<p>If you want to save yourself the effort of repeatedly typing the same details over and over, just tell mytop what you want it to choose if you don&rsquo;t tell it any parameters</p>

<p>All you need to do is let mytop know how to connect to your MySQL database in the form of a config file called .mytop in your home folder, with the following contents (replace as necessary):</p>

<blockquote>
<code>
     user=myuser
         pass=
         host=my.host.name
         db=
         delay=5
         port=3306
         socket=
         batchmode=0
         header=1
         color=1
         idle=1
</code>
</blockquote>


<p>You can add as many or as few of these as you like for easy configuration, like specifying the db flag if you&rsquo;re primarily accessing only one database. I like to leave the password field blank, and use the &mdash;prompt flag to avoid any awkward leaks!</p>
</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-08-14T14:05:32+01:00" pubdate data-updated="true">Aug 14<span>th</span>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/linux/running-php-scripts-as-apache-or-a-shell-user.html">Running PHP Scripts as Apache or a Shell User</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>If you have PHP scripts that need to be able to run via the web server as Apache and also be runnable directly on the command line then you may run into permissions issues, especially if those scripts are doing anything with files.</p>

<p>The scenario is that you run the script via the webserver and all of the files etc that are created are owned by Apache. Then you try to run on the command line and the script cannot run because it does not have permission to access Apache&rsquo;s files. The opposite scenario is also true.</p>

<p>There are a few possible solutions to this but the most elegant and simple is to do the follwing.</p>

<p>Assuming you are running Centos, you first of all need to set Apache to run with a umask of 002. This means that files it creates will have read/write permissions for the Apache group as well as the Apache user.</p>

<p>To do this, simply add a line to the file /etc/sysconfig/httpd. You can do this in one command like this:</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">echo</span> <span class="s2">&quot;umask 002&quot;</span> &gt;&gt; /etc/sysconfig/httpd
</span></code></pre></td></tr></table></div></figure>


<p>Then you need to restart Apache to apply this.</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>service httpd restart
</span></code></pre></td></tr></table></div></figure>


<p>You then need to add your shell user to the apache group. To do this you need to do the following:</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>vigr
</span></code></pre></td></tr></table></div></figure>


<p>Then find the line with your shell user and at the end add a comma and the word apache. This will add that user to the apache group along with it&rsquo;s own group.</p>

<p>You will get a prompt to also edit etc/shadow. Agree to this and repeat the process.</p>

<p>You will then need to log out and log back in to apply those changes and that should resolve your permissions issues for good.</p>
</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-08-14T13:54:17+01:00" pubdate data-updated="true">Aug 14<span>th</span>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/magento/stop-magento-writing-to-tmp.html">Stop Magento Writing to /tmp</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>So some of us disagree when it comes to what should happen when magento cannot write to var/ in the webroot.  Magento itself chooses to try /tmp/magento/ if the var/ folder is not writable.  This can cause many issues and confusion.  Not least of which emptying var/ and making it writable does not make magento start using it, if there&rsquo;s already a /tmp/magento!</p>

<p>One preferable option is to force magento to just stop if it can&rsquo;t write to var/ &ndash; here&rsquo;s a simple way to do this, which is sneaky but really handy :&ndash;</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /tmp
</span><span class='line'>ln -s abracadabra-dangling-symlink magento
</span></code></pre></td></tr></table></div></figure>


<p>What that does is create a dangling symlink in /tmp/ called magento, which cannot be overwritten by a directory.  Magento then simply stops.  Stopping because of permissions errors is often preferable to continuing and causing later confusion and problems.</p>
</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-08-09T16:24:34+01:00" pubdate data-updated="true">Aug 9<span>th</span>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/linux/creating-rpms.html">Creating RPMs</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>One thing that I often get asked as a package maintainer is how hard is it to make rpms?</p>

<p>Well, here&rsquo;s a little secret, if you have the right tools, it&rsquo;s actually quite easy.</p>

<p>The main tool I use is mezzanine &ndash; one of the people I worked with on the cAos Linux distributions wrote this toolset in perl, and it is installable even on debian-based distros.  His website is experiencing issues at the moment but it is <a href="http://beta.kainx.org/" title="http://beta.kainx.org/"><a href="http://beta.kainx.org/">http://beta.kainx.org/</a></a>.  If it&rsquo;s still down and you want the rpm, rpm.pbone.net can find you an rpm.</p>

<p>The basics are that you need a folder that contains an &ldquo;F&rdquo; &ldquo;P&rdquo; and &ldquo;S&rdquo; directory, and yes, that is all uppercase.  The F folder contains a spec file similar to what&rsquo;s below, the S folder contains the source files and the P directory is a clever little patch making system.</p>

<p>The spec file is almost exactly the same as a normal rpmbuild spec file and looks like this :&ndash;
<code>
#</p>

<h1>spec file for safe-rm</h1>

<p>#
Summary: Don&rsquo;t rm various directorie
Name: safe-rm
Version: 0.8
Release: 1
License: GPL
Group: Applications/Utilities
Source: <a href="https://launchpad.net/safe-rm/trunk/0.8/+download/safe-rm-0.8.tar.gz">https://launchpad.net/safe-rm/trunk/0.8/+download/safe-rm-0.8.tar.gz</a>
URL: <a href="https://launchpad.net/safe-rm">https://launchpad.net/safe-rm</a>
Distribution: CentOS
Packager: Martyn Ranyard <a href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#58;&#x69;&#110;&#x66;&#111;&#64;&#x65;&#100;&#109;&#x6f;&#110;&#100;&#x73;&#x63;&#x6f;&#109;&#x6d;&#101;&#x72;&#x63;&#101;&#x2e;&#99;&#x6f;&#46;&#117;&#x6b;">&#x69;&#x6e;&#x66;&#111;&#x40;&#101;&#100;&#x6d;&#111;&#110;&#100;&#115;&#99;&#111;&#x6d;&#109;&#x65;&#114;&#99;&#x65;&#x2e;&#99;&#111;&#46;&#117;&#107;</a>
Patch1000: safe-rm-0.8-example-conf.patch
Requires: perl</p>

<p>%description
Stop people accidentally removing directories with rm -rf</p>

<p>%changelog
* Thu Aug 09 2012 Martyn Ranyard <a href="&#109;&#97;&#105;&#x6c;&#x74;&#111;&#58;&#105;&#110;&#x66;&#x6f;&#64;&#101;&#x64;&#109;&#x6f;&#110;&#100;&#x73;&#x63;&#x6f;&#109;&#x6d;&#x65;&#x72;&#x63;&#x65;&#46;&#x63;&#x6f;&#46;&#117;&#x6b;">&#105;&#x6e;&#102;&#111;&#x40;&#x65;&#100;&#109;&#111;&#110;&#x64;&#x73;&#99;&#111;&#x6d;&#x6d;&#x65;&#114;&#99;&#x65;&#46;&#x63;&#111;&#x2e;&#117;&#107;</a>
&ndash; Used the debian example config for the default config</p>

<p>%prep
rm -rf $RPM_BUILD_ROOT/safe-rm-0.8
zcat $RPM_SOURCE_DIR/safe-rm-0.8.tar.gz | tar -xvf &ndash;
cd safe-rm-0.8
%patch1000 -p1</p>

<p>%build</p>

<p>%install
mkdir -p $RPM_BUILD_ROOT/usr/bin/
mkdir -p $RPM_BUILD_ROOT/etc/
mkdir -p $RPM_BUILD_ROOT/sbin/
install -m 0755 safe-rm-0.8/safe-rm $RPM_BUILD_ROOT/usr/bin/safe-rm
install -m 0644 safe-rm-0.8/safe-rm.conf $RPM_BUILD_ROOT/etc/safe-rm.conf
cd $RPM_BUILD_ROOT/usr/bin/
ln -s safe-rm rm
cd &ndash;
cd $RPM_BUILD_ROOT/sbin/
ln -s /usr/bin/safe-rm rm
cd &ndash;</p>

<p>%files
/etc
/etc/safe-rm.conf
/usr
/usr/bin
/usr/bin/safe-rm
/sbin
/sbin/rm
</code></p>

<p>You&rsquo;ll notice the patch1000 lines reference a patch file, which mezzanine handily creates for you, first you run mzprep, which creates a work dir, then you add/edit files in there to make whatever you&rsquo;re packaging build and install (to $RPM_BUILD_DIR) and then you run &ldquo;mzpatch mypatchname.patch&rdquo; and it creates the patch ready to be deployed.</p>

<p>To create the rpms, change back to the top level directory (the one containing F P &amp; S) and type mzbuild.</p>

<p>It takes a bit of getting used to and a fair bit of fiddling but the end result is good solid rpms.</p>

<p>Note: it can also make deb files and slackware package files but KainX is the guy to talk to on that front.</p>
</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2012-08-09T15:59:14+01:00" pubdate data-updated="true">Aug 9<span>th</span>, 2012</time>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/linux/safe-rm-saves-you-from-rm-rf.html">Safe-rm - Saves You From Rm -rf /*</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Okay, so it&rsquo;s a sysadmin&rsquo;s nightmare that you might when tired miss out a dot from an rm -rf ./* and whilst you shouldn&rsquo;t run as root, there are times when permissions problems push you into it.</p>

<p>This little gem allows you to blacklist folders from rm (such as /etc /bin and other system directories, along with any custom ones you might want to protect).</p>

<p>It&rsquo;s in debian/ubuntu repositories so apt-get install safe-rm is quite useful, but it seems to be nowhere to be found for CentOS/RHEL, so we packaged it up (one of our employees used to be a package maintainer for a linux distro) for CentOS servers.</p>

<p>The original url for safe-rm is <a href="https://launchpad.net/safe-rm" title="https://launchpad.net/safe-rm"><a href="https://launchpad.net/safe-rm">https://launchpad.net/safe-rm</a></a> and our rpm is available <a href="http://www.edmondscommerce.co.uk/stuff/safe-rm-0.8-1.x86_64.rpm" title="here">here</a> &ndash; Feel free to mirror this elsewhere.</p>

<p>Next up: <a href="http://www.edmondscommerce.co.uk/linux/creating-rpms/" title="how we created the rpm">how we created the rpm</a></p>
</div>
  
  


        </article>
      
    </div>

    <ul class="pager">
      
        <li class="previous"><a href="/page/23/">&larr;&nbsp;Older</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
        <li class="next"><a href="/page/21/">Newer&nbsp;&rarr;</a></li>
      
    </ul>
  </div>

  
    <aside class="sidebar col-md-3">
      
        <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/bash/bash-script-to-kill-sleeping-mysql-processes.html">Bash Script to Kill Sleeping MySQL Processes</a>
    
    <a class="list-group-item " href="/apache/blocking-direct-ip-access-in-apache.html">Blocking Direct IP Access in Apache</a>
    
    <a class="list-group-item " href="/composer/composer-run-utility-bash-script.html">Composer Run Utility BASH Script</a>
    
    <a class="list-group-item " href="/php/getting-sub-domains-and-domain-from-a-url.html">Getting Sub Domains and Domain From a Url</a>
    
    <a class="list-group-item " href="/security/ssl-testing-and-sha-1-sunsetting.html">SSL Testing and SHA-1 Sunsetting</a>
    
  </div>
</section>




<section class="googleplus panel panel-default">
  <div class="panel-body">
    <h3>
      <a href="https://plus.google.com/104488822194646220248?rel=author">
        <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
        Google+
      </a>
    </h3>
  </div>
</section>


<section class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">About Us</h3>
    </div>
    <div class="panel-body">
        <p>
            <a href="http://www.edmondscommerce.co.uk">Edmonds Commerce</a> are a UK based E-Commerce web development
            agency.
        </p>

        <p>
            We are based in <a href="http://www.yorkshire.com/">Yorkshire</a> near <a
                href="http://www.visitleeds.co.uk/">Leeds</a> and <a href="http://www.visitbradford.com/">Bradford</a>.
        </p>

        <p>
            Our primary specialism is <a href="http://magento.com/">Magento</a> and other PHP based E-Commerce platforms
            such as <a href="http://www.opencart.com/">OpenCart</a>.
        </p>

        <p>
            In terms of technology we are very strong in:
        <ul>
            <li><a href="http://php.net/">PHP</a>,</li>
            <li><a href="http://www.mysql.com/">MySQL</a>,</li>
            <li><a href="http://www.linuxfoundation.org/">Linux</a>,</li>
            <li><a href="http://www.w3.org/standards/techs/html#w3c_all">HTML<a/>,</li>
            <li><a href="http://www.w3.org/Style/CSS/Overview.en.html">CSS</a></li>
            <li><a href="http://en.wikipedia.org/wiki/JavaScript">Javascript</a>.</li>
        </ul>
        </p>
    </div>
</section>

<section class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Commercial Enquiries</h3>
    </div>
    <div class="panel-body">
        <p>
            If you would like to discuss your project requirements then please get in touch today.
        </p>

        <p>
            <a href="http://www.edmondscommerce.co.uk">www.edmondscommerce.co.uk</a><br/><br/>
            <a href="mailto:info@edmondscommerce.co.uk">info@edmondscommerce.co.uk</a><br/><br/>
            <a href="tel:00441274590036">+44 1274 590036</a>
        </p>
    </div>
</section>

      
    </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2014 - EdmondsCommerce Development Team<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>






  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </body>
</html>
