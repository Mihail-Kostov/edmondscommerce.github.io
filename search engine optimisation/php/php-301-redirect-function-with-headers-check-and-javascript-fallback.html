<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>PHP 301 Redirect Function with Headers Check and Javascript Fallback - Edmonds Commerce Dev Blog</title>
  <meta name="author" content="EdmondsCommerce Development Team">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://edmondscommerce.github.io/search%20engine%20optimisation/php/php-301-redirect-function-with-headers-check-and-javascript-fallback.html">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Edmonds Commerce Dev Blog" type="application/atom+xml">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-27853727-2', 'edmondscommerce.github.io');
  ga('send', 'pageview');

</script>

</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img height="20" src="https://2.gravatar.com/avatar/04b807394911b26ea8a79dbe25ea4e1a?d=https%3A%2F%2Fidenticons.github.com%2Fccb745f4b144d30c4b883330a1114834.png&amp;r=x&amp;s=140" width="20"> Dev Blog</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
                
                <li ><a href="/categories/index.html">Categories</a></li>
                
                <li ><a href="/contact-us/index.html">Contact</a></li>
                
            </ul>
            <ul class="nav pull-right">
                
                
                <li><a href="http://linkedin.com/in/edmondscommerce" title="Linkedin Profile"><i class="icon-linkedin-sign social-navbar"></i></a></li>
                
                
                
                <li><a href="http://plus.google.com/104488822194646220248" title="Google+ Profile"><i class="icon-google-plus-sign social-navbar"></i></a></li>
                
                
                
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:edmondscommerce.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <article class="hentry" role="article">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2008-05-22T15:46:48+01:00" pubdate data-updated="true">May 22<span>nd</span>, 2008</time>
        
      </p>
    
    
    <h1 class="entry-title">
        PHP 301 Redirect Function With Headers Check and Javascript Fallback
        
    </h1>
    
  </header>


<div class="entry-content clearfix"><div class="oldpost"><h4>This is an old post. The information it contains is probably out of date or innacurate</h4>
<p>
This is a post that was written a long time ago and is only being kept here for posterity.
You should probably look up more recent blog posts related to the subject you are researching
</p>
</div>


<p>If you are changing your URL structure, for example when moving to a search engine friendly URLs system, you need to be able to let Google and all the other search engines that the page has moved to the new URL. You really don&rsquo;t want to display the same content on two URLs</p>

<p>So to achieve this we can do what is called a 301 redirect. This is a special redirect message which basically says &ldquo;has permanently moved to&rdquo;. By doing this, all of the search engine power, rank or whatever you want to call it will be directly transferred to the new URL.</p>

<p><strong>However</strong></p>

<p>Sometimes your script might spit out the headers earlier than you expect. If this happens then your site will fail completely to load with a fatal error along the lines of</p>

<p><strong>warning: Cannot modify header information &ndash; headers already sent by (output started at .</strong>&hellip;</p>

<p>We really don&rsquo;t want this to happen, so what we can do is wrap the redirection in a headers_sent check and then fall back to a javascript redirect if headers have been sent for some reason. This is belt and braces logic.</p>

<p><i><b>Note script tags need spaces removing</b></i></p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">requrl_check</span><span class="p">(</span><span class="nv">$correct_url</span><span class="p">,</span> <span class="nv">$delay</span><span class="o">=</span><span class="mi">3</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$request_url</span> <span class="o">=</span> <span class="s1">&#39;http://&#39;</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">];</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$request_url</span> <span class="o">!=</span> <span class="nv">$correct_url</span><span class="p">){</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">headers_sent</span><span class="p">()){</span> <span class="c1">//going to assume that headers are not sent</span>
</span><span class='line'>      <span class="nx">header</span><span class="p">(</span><span class="s2">&quot;HTTP/1.1 301 Moved Permanently&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;location: &#39;</span> <span class="o">.</span> <span class="nv">$correct_url</span> <span class="o">.</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="k">exit</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>          <span class="k">echo</span> <span class="s2">&quot;&lt;h3&gt;The Page </span><span class="si">$request_url</span><span class="s2"> has Moved&lt;/h3&gt;</span>
</span><span class='line'><span class="s2">             &lt;a href=</span><span class="si">$correct_url</span><span class="s2">&gt;</span><span class="si">$correct_url</span><span class="s2">&lt;/a&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>          <span class="k">echo</span> <span class="s1">&#39;&lt;h3&gt;Now Refreshing in &#39;</span> <span class="o">.</span> <span class="nv">$delay</span> <span class="o">.</span> <span class="s1">&#39; Seconds&lt;/h3&gt;Refreshing to:&lt;br&gt;&#39;</span> <span class="o">.</span> <span class="nv">$correct_url</span> <span class="o">.</span> <span class="s1">&#39;&lt;s c r i p t type=&quot;text/JavaScript&quot;&gt;&lt;!--</span>
</span><span class='line'><span class="s1">     setTimeout(&quot;location.href = \&#39;&#39;</span> <span class="o">.</span> <span class="nv">$correct_url</span> <span class="o">.</span> <span class="s1">&#39;\&#39;;&quot;,&#39;</span> <span class="o">.</span> <span class="p">(</span><span class="nv">$delay</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">     --&gt; &lt;/s c r i p t&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>          <span class="k">exit</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>tidy :&ndash;)</p>

<p><b>Further Reading:</b>
<a rel="nofollow" href="http://www.stuntdubl.com/2005/09/06/301-redirects/">www.stuntdubl.com</a>
<a rel="nofollow" href="http://www.intertwingly.net/blog/911.html">www.intertwingly.ne</a>
<a rel="nofollow" href="http://webgasm.actiononline.biz/seo/?p=87">webgasm.actiononline.biz</a>
<a rel="nofollow" href="http://www.techcounter.com/seo/permalink-migration-for-a-wordpress-blog-using-a-301-redirect/">www.techcounter.com</a>
<a rel="nofollow" href="http://www.chiropractichomepage.com/2007/03/16/chiropractor-web-page-gets-301-redirect/">www.chiropractichomepage.com</a>
<a rel="nofollow" href="http://123howtoguide.com/seo/how-to-redirect-a-web-page-using-301-redirect">123howtoguide.com</a>
<a rel="nofollow" href="http://searchblog.tamar.com/2007/07/understanding-t.html">searchblog.tamar.com</a></p>
</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="byline author vcard">Posted by <span class="fn">admin</span></span></span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2008-05-22T15:46:48+01:00" pubdate data-updated="true">May 22<span>nd</span>, 2008</time>
          

<span class="glyphicon glyphicon-folder-open" title="categories"></span>&nbsp;
<span class="categories">
  
    <a class='category label label-primary' href='/category/php/'>php</a> <a class='category label label-primary' href='/category/search-engine-optimisation/'>search engine optimisation</a>
  
</span>


          

<br/>
<span class="glyphicon glyphicon-tags" title="tags"></span>&nbsp;
<span class="tags">
  
    <a class='tag' href='/tag/edmondscommerce/'>edmondscommerce</a>
  
</span>



        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://edmondscommerce.github.io/search%20engine%20optimisation/php/php-301-redirect-function-with-headers-check-and-javascript-fallback.html" data-via="" data-counturl="http://edmondscommerce.github.io/search%20engine%20optimisation/php/php-301-redirect-function-with-headers-check-and-javascript-fallback.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/oscommerce/oscommerce-contribution-released-server-migration-synchronisation.html" title="Previous Post: osCommerce Contribution Released: Server Migration Synchronisation">&laquo; osCommerce Contribution Released: Server Migration Synchronisation</a></li>
            
            
            <li class="next"><a href="/php/scraping/php-random-sleep-function-with-flush.html" title="Next Post: PHP Random Sleep Function with Flush">PHP Random Sleep Function with Flush &raquo;</a></li>
            
          </ul>
        
      </footer>
    </article>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/Octoress/octopress-auto-building-the-site-locally-for-one-blog-post.html">Octopress Auto Building the Site Locally for One Blog Post</a>
    
    <a class="list-group-item " href="/mysql/sorting-results-arbitrarily-in-mysql.html">Sorting Results Arbitrarily in MySQL</a>
    
    <a class="list-group-item " href="/symfony2/faker-symfony2-integration.html">Faker Symfony2 Integration</a>
    
    <a class="list-group-item " href="/chrome/trigger-basic-auth-popup-in-chrome.html">Trigger Basic Auth Popup in Chrome</a>
    
    <a class="list-group-item " href="/Symonfy2/symonfy2-phpstorm-project-setup.html">Symonfy2 PHPStorm Project Setup</a>
    
  </div>
</section>




<section class="googleplus panel panel-default">
  <div class="panel-body">
    <h3>
      <a href="https://plus.google.com/104488822194646220248?rel=author">
        <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
        Google+
      </a>
    </h3>
  </div>
</section>


<section class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">About Us</h3>
    </div>
    <div class="panel-body">
        <p>
            <a href="http://www.edmondscommerce.co.uk">Edmonds Commerce</a> are a UK based E-Commerce web development
            agency.
        </p>

        <p>
            We are based in <a href="http://www.yorkshire.com/">Yorkshire</a> near <a
                href="http://www.visitleeds.co.uk/">Leeds</a> and <a href="http://www.visitbradford.com/">Bradford</a>.
        </p>

        <p>
            Our primary specialism is <a href="http://magento.com/">Magento</a> and other PHP based E-Commerce platforms
            such as <a href="http://www.opencart.com/">OpenCart</a>.
        </p>

        <p>
            In terms of technology we are very strong in:
        <ul>
            <li><a href="http://php.net/">PHP</a>,</li>
            <li><a href="http://www.mysql.com/">MySQL</a>,</li>
            <li><a href="http://www.linuxfoundation.org/">Linux</a>,</li>
            <li><a href="http://www.w3.org/standards/techs/html#w3c_all">HTML<a/>,</li>
            <li><a href="http://www.w3.org/Style/CSS/Overview.en.html">CSS</a></li>
            <li><a href="http://en.wikipedia.org/wiki/JavaScript">Javascript</a>.</li>
        </ul>
        </p>
    </div>
</section>

<section class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Commercial Enquiries</h3>
    </div>
    <div class="panel-body">
        <p>
            If you would like to discuss your project requirements then please get in touch today.
        </p>

        <p>
            <a href="http://www.edmondscommerce.co.uk">www.edmondscommerce.co.uk</a><br/><br/>
            <a href="mailto:info@edmondscommerce.co.uk">info@edmondscommerce.co.uk</a><br/><br/>
            <a href="tel:00441274590036">+44 1274 590036</a>
        </p>
    </div>
</section>

    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2013 - EdmondsCommerce Development Team<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>






  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </body>
</html>
