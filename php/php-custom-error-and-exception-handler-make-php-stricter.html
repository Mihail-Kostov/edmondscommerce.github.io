<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>PHP Custom Error and Exception Handler - Make PHP Stricter - Edmonds Commerce Dev Blog</title>
  <meta name="author" content="EdmondsCommerce Development Team">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://edmondscommerce.github.io/php/php-custom-error-and-exception-handler-make-php-stricter.html">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Edmonds Commerce Dev Blog" type="application/atom+xml">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-27853727-2', 'edmondscommerce.github.io');
  ga('send', 'pageview');

</script>

</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><img height="20" src="https://2.gravatar.com/avatar/04b807394911b26ea8a79dbe25ea4e1a?d=https%3A%2F%2Fidenticons.github.com%2Fccb745f4b144d30c4b883330a1114834.png&amp;r=x&amp;s=140" width="20"> Dev Blog</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
                
                <li ><a href="/categories/index.html">Categories</a></li>
                
                <li ><a href="/contact-us/index.html">Contact</a></li>
                
            </ul>
            <ul class="nav pull-right">
                
                
                <li><a href="http://linkedin.com/in/edmondscommerce" title="Linkedin Profile"><i class="icon-linkedin-sign social-navbar"></i></a></li>
                
                
                
                <li><a href="http://plus.google.com/104488822194646220248" title="Google+ Profile"><i class="icon-google-plus-sign social-navbar"></i></a></li>
                
                
                
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:edmondscommerce.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <article class="hentry" role="article">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2011-05-12T11:20:58+01:00" pubdate data-updated="true">May 12<span>th</span>, 2011</time>
        
      </p>
    
    
    <h1 class="entry-title">
        PHP Custom Error and Exception Handler - Make PHP Stricter
        
    </h1>
    
  </header>


<div class="entry-content clearfix"><div class="oldpost"><h4>This is post is now quite old and the the information it contains may be out of date or innacurate.</h4>
<p>
If you find any errors or have any suggestions to update the information <a href="http://edmondscommerce.github.io/contact-us/index.html">please let us know</a>
or <a href="https://github.com/edmondscommerce/edmondscommerce.github.io">create a pull request on GitHub</a>
</p>
</div>


<p>If you prefer a coding style that doesn&rsquo;t let you get away with as much as PHP does by default then you may like this trick.</p>

<p>As standard PHP will let you get away with quite a lot of things that are probably not a good idea. Some times that can be great, allowing you to quickly prototype things or achieve results quickly without having to go through nit picking your code.</p>

<p>However on the other hand if you are working on a production system that you would really rather complained as much as possible in the dev stage to help to minimise the likelihood that bugs will creep through to production then this looseness can work against you.</p>

<p>For this reason I often use this trick to make PHP much more fussy and strict and make errors much more obvious and easier to deal with.</p>

<p>First of all, we need to create a custom error handler. This will override the standard error handling in PHP and allow us to do what we want. What I am going to do is convert all of the standard PHP errors into exceptions.</p>

<p><b>Error Handler</b></p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">ec_error_handler</span><span class="p">(</span><span class="nv">$severity</span><span class="p">,</span> <span class="nv">$message</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$lineno</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">error_reporting</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//if (error_reporting() &amp; $severity) {</span>
</span><span class='line'>    <span class="k">throw</span> <span class="k">new</span> <span class="nx">ErrorException</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$severity</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$lineno</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You will notice that 2 lines are commented out. If uncommented, this will respect the error reporting settings of PHP. Commented out it throws an exception regardless of PHP error reporting settings.</p>

<p>To make PHP use this function as my error handler we do the following:</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nb">set_error_handler</span><span class="p">(</span><span class="s1">&#39;ec_error_handler&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>So now every PHP error, notice etc is being converted into an exception. This gives me the ability to view stack traces and see exactly which file, line etc is involved so tracking issues down is a snap.</p>

<p>Now though I want a nice system to capture these exceptions and dump this info to the screen.</p>

<p><b>Exception Handler</b></p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">ec_exceptions_handler</span><span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">ob_start</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">h</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Uncaught Exception&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">h</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
</span><span class='line'>    <span class="nx">h</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Line &#39;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getLine</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39; of &#39;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getFile</span><span class="p">());</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getTrace</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$t</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$t</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">dumpObjects</span><span class="p">();</span>
</span><span class='line'>    <span class="nv">$exceptionMessage</span> <span class="o">=</span> <span class="nb">ob_get_clean</span><span class="p">();</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$exceptionMessage</span><span class="p">;</span>
</span><span class='line'>    <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This function starts the output buffer then dumps a large amount of information including the message, line and file for the exception. The full stack trace.</p>

<p>It&rsquo;s also dumping all global objects using another function.</p>

<p>This output is captured into a variable with ob_get_clean(). At this point, you might decide to log this variable to a file, database, ticketing system etc &ndash; I leave that bit to you. Finally the info is dumped to the screen and the program exits.</p>

<p>Of course this is not something you should do in a production environment, this level of information on a production system is a welcome invitation to hackers to exploit you. However in a secure local dev environment its exactly what you need.</p>

<p>To get PHP to use this exception handler, we do the following:</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nb">set_exception_handler</span><span class="p">(</span><span class="s1">&#39;ec_exceptions_handler&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here are the other functions you will need:</p>

<p><b>Dump Objects</b>
This one simply var dumps all the objects as they are at the time of the exception. This may be overkill for your situation, I leave that up to you.</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">dumpObjects</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">h</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Dumping Objects&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$GLOBALS</span> <span class="k">as</span> <span class="nv">$g</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">is_object</span><span class="p">(</span><span class="nv">$g</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">h</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$g</span><span class="p">));</span>
</span><span class='line'>            <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$g</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><b>H Tag Helper</b>
And this is just a html helper to create H tags</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">h</span><span class="p">(</span><span class="nv">$n</span><span class="p">,</span> <span class="nv">$m</span><span class="p">){</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;&lt;h</span><span class="si">$n</span><span class="s2">&gt;</span><span class="si">$m</span><span class="s2">&lt;/h</span><span class="si">$n</span><span class="s2">&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nb">flush</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I hope you find this useful. Feel free to add any comments etc below.</p>
</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="byline author vcard">Posted by <span class="fn">admin</span></span></span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2011-05-12T11:20:58+01:00" pubdate data-updated="true">May 12<span>th</span>, 2011</time>
          

<span class="glyphicon glyphicon-folder-open" title="categories"></span>&nbsp;
<span class="categories">
  
    <a class='category label label-primary' href='/category/php/'>php</a>
  
</span>


          

<br/>
<span class="glyphicon glyphicon-tags" title="tags"></span>&nbsp;
<span class="tags">
  
    <a class='tag' href='/tag/custom/'>custom</a>, <a class='tag' href='/tag/debug/'>debug</a>, <a class='tag' href='/tag/development/'>development</a>, <a class='tag' href='/tag/error/'>error</a>, <a class='tag' href='/tag/exception/'>exception</a>, <a class='tag' href='/tag/handler/'>handler</a>, <a class='tag' href='/tag/notice/'>notice</a>, <a class='tag' href='/tag/php/'>php</a>, <a class='tag' href='/tag/strict/'>strict</a>, <a class='tag' href='/tag/warning/'>warning</a>
  
</span>



        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://edmondscommerce.github.io/php/php-custom-error-and-exception-handler-make-php-stricter.html" data-via="" data-counturl="http://edmondscommerce.github.io/php/php-custom-error-and-exception-handler-make-php-stricter.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/linux/mysql-got-error-28-from-storage-engine-solution.html" title="Previous Post: MySQL Got Error 28 From Storage Engine + Solution">&laquo; MySQL Got Error 28 From Storage Engine + Solution</a></li>
            
            
            <li class="next"><a href="/netbeans/netbeans-path-tools-plugin.html" title="Next Post: Netbeans Path Tools Plugin">Netbeans Path Tools Plugin &raquo;</a></li>
            
          </ul>
        
      </footer>
    </article>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/fixing-product-breadcrumbs-in-magento.html">Fixing Product Breadcrumbs in Magento</a>
    
    <a class="list-group-item " href="/magento/using-magento-1-dot-9-1-s-colour-swatches-in-your-theme.html">Using Magento 1.9.1's Colour Swatches in Your Custom Theme</a>
    
    <a class="list-group-item " href="/git/removing-untracked-files-but-not-git-ignored-ones.html">Removing Untracked Files but Not Git Ignored Ones</a>
    
    <a class="list-group-item " href="/php/developer-setup.html">Preparing Fedora for Development With PHP Storm</a>
    
    <a class="list-group-item " href="/linux/vps/server/running-out-of-disk-space-but-df-shows-you-have-lots-of-space-left.html">Running Out of Disk Space but Df Shows You Have Lots of Space Left</a>
    
  </div>
</section>




<section class="googleplus panel panel-default">
  <div class="panel-body">
    <h3>
      <a href="https://plus.google.com/104488822194646220248?rel=author">
        <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
        Google+
      </a>
    </h3>
  </div>
</section>


<section class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">About Us</h3>
    </div>
    <div class="panel-body">
        <p>
            <a href="http://www.edmondscommerce.co.uk">Edmonds Commerce</a> are a UK based E-Commerce web development
            agency.
        </p>

        <p>
            We are based in <a href="http://www.yorkshire.com/">Yorkshire</a> near <a
                href="http://www.visitleeds.co.uk/">Leeds</a> and <a href="http://www.visitbradford.com/">Bradford</a>.
        </p>

        <p>
            Our primary specialism is <a href="http://magento.com/">Magento</a> and other PHP based E-Commerce platforms
            such as <a href="http://www.opencart.com/">OpenCart</a>.
        </p>

        <p>
            In terms of technology we are very strong in:
        <ul>
            <li><a href="http://php.net/">PHP</a>,</li>
            <li><a href="http://www.mysql.com/">MySQL</a>,</li>
            <li><a href="http://www.linuxfoundation.org/">Linux</a>,</li>
            <li><a href="http://www.w3.org/standards/techs/html#w3c_all">HTML<a/>,</li>
            <li><a href="http://www.w3.org/Style/CSS/Overview.en.html">CSS</a></li>
            <li><a href="http://en.wikipedia.org/wiki/JavaScript">Javascript</a>.</li>
        </ul>
        </p>
    </div>
</section>

<section class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Commercial Enquiries</h3>
    </div>
    <div class="panel-body">
        <p>
            If you would like to discuss your project requirements then please get in touch today.
        </p>

        <p>
            <a href="http://www.edmondscommerce.co.uk">www.edmondscommerce.co.uk</a><br/><br/>
            <a href="mailto:info@edmondscommerce.co.uk">info@edmondscommerce.co.uk</a><br/><br/>
            <a href="tel:00441274590036">+44 1274 590036</a>
        </p>
    </div>
</section>

    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2015 - EdmondsCommerce Development Team<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>






  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </body>
</html>
