<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: php | Edmonds Commerce Dev Blog]]></title>
  <link href="http://edmondscommerce.github.io/category/php/atom.xml" rel="self"/>
  <link href="http://edmondscommerce.github.io/"/>
  <updated>2015-06-30T14:38:16+01:00</updated>
  <id>http://edmondscommerce.github.io/</id>
  <author>
    <name><![CDATA[EdmondsCommerce Development Team]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Preparing Fedora for development with PHP Storm]]></title>
    <link href="http://edmondscommerce.github.io/php/developer-setup.html"/>
    <updated>2015-06-15T16:25:22+01:00</updated>
    <id>http://edmondscommerce.github.io/php/developer-setup</id>
    <content type="html"><![CDATA[<p>Today I was asked to prepare a workstation system for development with PHP Storm, this was my first time using Fedora over the popular Ubuntu so here&rsquo;s how it went.</p>

<p>Starting out, I visited the PHP Storm website hosted by the friendly people over at JetBrains to get a hold of my favourite IDE to develop with.
The package comes as a compressed tar ball that needs extracting with your favourite decompression software of choice.</p>

<p>After extracting the IDE it is time to do install it, when I attempted this I quickly ran in to a problem with the open source version of Java that comes pre-installed with Fedora.
To remedy this you need to get the Oracle version of the Java Run Times to install and run PHP Storm successfully.</p>

<p>After installing Java it is important that you tell Fedora to use Oracle&rsquo;s version over the pre-installed OpenJDK mentioned before.</p>

<p><code>alternatives --install /usr/bin/java java /usr/java/latest/jre/bin/java 200000</code></p>

<p>This will force Fedora to use this specific version of Java over the default, the procedure is similar to using an alias.</p>

<p>After we have Fedora setup to use the correct version of Java we can happily install and run PHP Storm.
CD in to your extracted PHP Storm folder we created earlier.</p>

<pre><code>cd bin
./phpstorm.sh
</code></pre>

<p>During the process you will be given the option to create a shortcut meaning you won&rsquo;t need to use the terminal to launch the IDE.
With that said, you can now happily use PHP Storm to develop your applications, be wary if you switch your Java version back to open source as it may not be supported.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Getting sub domains and domain from a url]]></title>
    <link href="http://edmondscommerce.github.io/php/getting-sub-domains-and-domain-from-a-url.html"/>
    <updated>2014-11-14T13:34:08+00:00</updated>
    <id>http://edmondscommerce.github.io/php/getting-sub-domains-and-domain-from-a-url</id>
    <content type="html"><![CDATA[<p>At first it seems like a simple one &ndash; just use the <code>parse_url</code> function already built into PHP.</p>

<p>Unfortunately though, this just gives you the host &ndash; which is usually a combination of a subdomain &ndash; such as www &ndash; and the domain itself.</p>

<p>To resolve this I ended up writing the following code. It will gradually snip bits off the start of a host and then make a HTTP request until that request fails.</p>

<p>Once it fails, we know that we have snipped off all of the sub domains we can and we have our final domain.</p>

<p>Here is the code:</p>

<p>``` php</p>

<pre><code>public function getDomain($url)
{
    if (!$this-&gt;_domain) {
        $host = parse_url($url, PHP_URL_HOST);
        $sanity = $this-&gt;getHeadersForUrl($host);
        if (!$sanity) {
            throw new ErrorException("No headers when sanity checking full host: $host in " . __METHOD__);
        }
        $elems = explode('.', $host);
        $subdomains = array();
        $domain = false;
        while (!$domain) {
            $check = implode('.', $elems);
            $headers = $this-&gt;getHeadersForUrl($check);
            if ($headers) {
                $subdomains[] = array_shift($elems);
            } else {
                array_unshift($elems, array_pop($subdomains));
                $domain = implode('.', $elems);
            }
        }
        $this-&gt;_domain = $domain;
    }
    return $this-&gt;_domain;
}

public function getHeadersForUrl($url, $followOnLocation = true)
{
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_HEADER, true);
    curl_setopt($ch, CURLOPT_NOBODY, true);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, $followOnLocation);
    curl_setopt($ch, CURLOPT_MAXREDIRS, 10);
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);

    $data = curl_exec($ch);

    return $data;
}
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Simple Database Migrations]]></title>
    <link href="http://edmondscommerce.github.io/php/simple-database-migrations.html"/>
    <updated>2014-04-28T13:22:34+01:00</updated>
    <id>http://edmondscommerce.github.io/php/simple-database-migrations</id>
    <content type="html"><![CDATA[<p>Some times you just need something simple to manage database versions. This few lines of PHP is something I have used on various projects to assist with database versioning.</p>

<p>It is definitely not a fully featured migrations system, there is no downgrade functionality, it is purely for versioning up a DB to the latest version.</p>

<p>Largely how it works is up to you as it is simply a way of requiring PHP files in numerical order.</p>

<p>Here is the code:</p>

<p>``` php
&lt;?php
$res = mysql_fetch_assoc(db_query(&ldquo;select version from db_migrations order by version desc limit 0,1&rdquo;));
$current_version = ($res[&lsquo;version&rsquo;]) ? $res[&lsquo;version&rsquo;] : 0;
$di = new DirectoryIterator(<strong>DIR</strong> . &lsquo;/migrations&rsquo;);
$torun = array();
foreach ($di as $f) {</p>

<pre><code>/* @var $f DirectoryIterator */
if ($f-&gt;isDot()) {
    continue;
}
if ('php' == pathinfo($f-&gt;getFilename(), PATHINFO_EXTENSION)) {
    $exp = explode('.', strval($f));
    if (2 != count($exp)) {
        throw new Exception('#1 Invalid migration file ' . strval($f) . ' in ' . __FILE__);
    }
    $version = $exp[0];
    if (!is_numeric($version)) {
        throw new Exception('#2 Invalid migration file ' . strval($f) . ' in ' . __FILE__);
    }
    if ($version &gt; $current_version) {
        $torun[$version] = strval($f);
    }
} else {
    throw new Exception('#3 Invalid migration file ' . strval($f) . ' in ' . __FILE__);
}
</code></pre>

<p>}</p>

<p>if (!empty($torun)) {</p>

<pre><code>ksort($torun, SORT_NUMERIC);
foreach ($torun as $v =&gt; $t) {
    require(__DIR__ . '/migrations/' . $t);
    h(3, 'Database Migrations - running migration ' . $t);
    db_query("insert into db_migrations set version = '$v' ");
}
</code></pre>

<p>}</p>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Running PHP Scripts on CLI and Faking a Web Request]]></title>
    <link href="http://edmondscommerce.github.io/php/running-php-scripts-on-cli-and-faking-a-web-request.html"/>
    <updated>2014-02-14T17:31:14+00:00</updated>
    <id>http://edmondscommerce.github.io/php/running-php-scripts-on-cli-and-faking-a-web-request</id>
    <content type="html"><![CDATA[<p>Some times you build a PHP script that is designed to run from a web request and you want to run it on the command line.
The problem is that you have used the standard PHP super globals and you would rather not refactor the script loads.</p>

<p>Here is a nice quick solution:</p>

<p>``` php
if(isset($argc)){</p>

<pre><code>for ($i = 1; $i &lt; $argc; $i++) {
    $things = explode("=", $argv[$i]);
    if (false !== stripos($things[0], 'POST:')) {
         $post = str_replace('POST:', '', $things[0]);
         $_POST[$post] = $things[1];
    } else {
         $_GET[$things[0]] = $things[1];
    }
}
</code></pre>

<p>}</p>

<p>echo &ldquo;\nGET:\n&rdquo;;
var_dump($<em>GET);
echo &ldquo;\nPOST:\n&rdquo;;
var_dump($</em>POST);</p>

<p><code>``
This will loop over the argc variable that is defined when running in CLI mode and will fake the</code>$<em>GET<code>and</code>$</em>POST` variables as required.</p>

<p>To run this with get and post variables you would do this:</p>

<p><code>
php -f script.php getvar1=test getvar2=foo POST:postvar1=bar
</code></p>

<p>And that&rsquo;s it. It is not particularly pretty but it can be pretty handy.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHPStorm Regex Convert Array to Object Syntax]]></title>
    <link href="http://edmondscommerce.github.io/php/phpstorm-regex-convert-array-to-object-syntax.html"/>
    <updated>2013-08-27T14:40:35+01:00</updated>
    <id>http://edmondscommerce.github.io/php/phpstorm-regex-convert-array-to-object-syntax</id>
    <content type="html"><![CDATA[<p>If you are converting some code from using array syntax to object property syntax then you might like this little snippet of regex.</p>

<p>This is design to paste straight into the find/replace dialogue in PHPStorm</p>

<p>Find:
```</p>

<p>\$(\w+)[&lsquo;([^&rsquo;]+)&lsquo;]</p>

<p>```</p>

<p>Replace:
```</p>

<p>\\$$1->$2</p>

<p>```</p>

<p>And that is it</p>
]]></content>
  </entry>
  
</feed>
