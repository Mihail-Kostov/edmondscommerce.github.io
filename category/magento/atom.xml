<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: magento | Edmonds Commerce Dev Blog]]></title>
  <link href="http://edmondscommerce.github.io/category/magento/atom.xml" rel="self"/>
  <link href="http://edmondscommerce.github.io/"/>
  <updated>2015-02-17T13:09:59+00:00</updated>
  <id>http://edmondscommerce.github.io/</id>
  <author>
    <name><![CDATA[EdmondsCommerce Development Team]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[SUPEE-5344 - a New Patch for Magento Community 1.6, 1.7, 1.8 and 1.9; Enterprise 1.11, 1.12, 1.13 and 1.14]]></title>
    <link href="http://edmondscommerce.github.io/magento/supee-5344-a-new-patch-for-magento-community-1-dot-6-1-dot-7-1-dot-8-and-1-dot-9-enterprise-1-dot-11-1-dot-12-1-dot-13-and-1-dot-14.html"/>
    <updated>2015-02-11T15:53:28+00:00</updated>
    <id>http://edmondscommerce.github.io/magento/supee-5344-a-new-patch-for-magento-community-1-dot-6-1-dot-7-1-dot-8-and-1-dot-9-enterprise-1-dot-11-1-dot-12-1-dot-13-and-1-dot-14</id>
    <content type="html"><![CDATA[<p>Magento has become aware of a vulnerability requiring patching as soon as possible. The vulnerability allows an attacker to send a specially crafted request to a Magento store and allow it to run Magento code as though it were on the live server. Magento aren&rsquo;t aware of this having been used in the wild, but now that the vulnerability is public, attackers may use it against existing stores.</p>

<p>This vulnerability affects all versions of Magento, and Magento have released patches for versions Community Edition 1.6 to 1.9, and Enterprise 1.11 to 1.14.</p>

<p>The fix is to apply some stricter IP address checks to requests.</p>

<h3>Patching your Magento store</h3>

<p>To get the patch:</p>

<p><em>Note: at time of writing, the Downloads of the CE edition seems to under heavy load and is currently presenting a white page instead of the shell file</em></p>

<ul>
<li><strong>Community Edition</strong> users should go to the <a href="http://www.magentocommerce.com/download">Magento downloads page</a> and scroll to the &ldquo;Magento Community Edition Patches&rdquo; section. From there, select your version of Magento and click Download</li>
<li><strong>Enterprise Edition</strong> users should log into their Magento account Magento Support Portal</li>
</ul>


<p>You&rsquo;ll be presented with a shell file which will make the necessary changes to your store. Upload this patch to your server in the Magento root and run it against your store.</p>

<p>The patch changes core files, and it&rsquo;s always recommended to test changes on a development copy before the live site, especially if you have modifications to your core code. Also keep in mind that any upgrades pre-1.9.0.1 will remove these changes, and the patch will have to be re-run.</p>

<ol>
<li><code>cd /your/magento/root/</code> &ndash; Navigate to the root of Magento</li>
<li><code>./sh PATCH_SUPEE-5344_CE_1.8.0.0_v1.sh</code> &ndash; Run the patches</li>
<li><code>rm PATCH_SUPEE-5344_CE_1.8.0.0_v1.sh</code> &ndash; Delete the patch file, so that it can&rsquo;t be re-run by the public</li>
<li><code>rm -rf var/cache/*</code> &ndash; Clear Magento&rsquo;s cache</li>
</ol>


<p>Reload a page and the patch will have taken effect.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SUPEE-3941 - A new patch for Magento Community 1.6, 1.7, 1.8 and 1.9; Enterprise 1.11, 1.12, 1.13 and 1.14]]></title>
    <link href="http://edmondscommerce.github.io/magento/supee-3941-a-new-patch-for-magento-community-1-dot-6-1-dot-7-1-dot-8-and-1-dot-9-enterprise-1-dot-11-1-dot-12-1-dot-13-and-1-dot-14.html"/>
    <updated>2015-02-11T10:54:06+00:00</updated>
    <id>http://edmondscommerce.github.io/magento/supee-3941-a-new-patch-for-magento-community-1-dot-6-1-dot-7-1-dot-8-and-1-dot-9-enterprise-1-dot-11-1-dot-12-1-dot-13-and-1-dot-14</id>
    <content type="html"><![CDATA[<p>This post was published with the incorrect vulnerability code; <a href="/magento/supee-5344-a-new-patch-for-magento-community-1-dot-6-1-dot-7-1-dot-8-and-1-dot-9-enterprise-1-dot-11-1-dot-12-1-dot-13-and-1-dot-14.html">this article has been moved to this post</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Intermittent PayPal IPN failure in Magento]]></title>
    <link href="http://edmondscommerce.github.io/magento/intermittent-paypal-ipn-failure-in-magento.html"/>
    <updated>2014-10-15T09:53:44+01:00</updated>
    <id>http://edmondscommerce.github.io/magento/intermittent-paypal-ipn-failure-in-magento</id>
    <content type="html"><![CDATA[<p>On one or two store we had an issue with intermittent IPN failures. Some paypal orders would be stuck on the &lsquo;Pending&rsquo; status even if there was a sucessful paypal payment. In the exception logs there would be the following exception being thrown &lsquo;PayPal IPN postback failure. See paypal_unknown_ipn.log for details.&rsquo; on line 156 of app/code/core/Mage/Paypal/Model/Ipn.php.</p>

<h3>What the issue turned out to be</h3>

<p>The issue turned out to be curl adding in extra error. On occasions curl will send the following header &lsquo;Expect: 100&rsquo;. The idea behind that is that rather than curl just send the data. It will send a inital request just to check if the web server will accept the data. Curl will usually fall on this bahaviour if the request is above a certain size.</p>

<p>It turns out that the magento implementation assumes that the response will be consitant. But with the ocasional &lsquo;Expect&rsquo; header bing in the request this is not always the case.</p>

<p>In the _postBack method in the IPN class where it makes the curl post back is recived there is the following code near to the end of the method.
``` php</p>

<pre><code>$response = preg_split('/^\r?$/m', $response, 2);
$response = trim($response[1]);
</code></pre>

<p>```</p>

<p>This code assumes the line position of where the &lsquo;VERIFIED&rsquo; line would occur. To resolve the header issue the following code should be used instead.
``` php</p>

<pre><code>$response = preg_split('/^\r?$/m', $response);
$response = trim(end($response));
</code></pre>

<p>```</p>

<p>As the &lsquo;VERIFIED&rsquo; line will always be the last line in the response. Regardless of any extra headers being added. This should resolve the issue but of corse remeber to use the local method and copy the class to the local folder with the correct path before doing the modification.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Magento 1.9 &amp; 1.14 released]]></title>
    <link href="http://edmondscommerce.github.io/magento/magento-1-dot-9-and-1-dot-14-released.html"/>
    <updated>2014-05-14T11:12:02+01:00</updated>
    <id>http://edmondscommerce.github.io/magento/magento-1-dot-9-and-1-dot-14-released</id>
    <content type="html"><![CDATA[<p>Magento has released the latest version of both CE and EE.</p>

<p>The big changes that are included are as follows</p>

<p><strong>Responsive design included as default</strong></p>

<p>Both editions now come with a responsive theme. This introduces jQuery, SASS, and Compass into native Magento and should allow for easier customisation in the future.</p>

<p><strong>Bill Me Later</strong></p>

<p>The PayPal integration has been upgraded to include the <a href="https://www.paypal.com/webapps/mpp/promotional-financing">Bill Me Later</a> financing option. This allows customer to pay for products over six months whilst the merchant gets paid straight away.</p>

<p><strong>Other security fix and performance fixes</strong></p>

<p>The full list of changes can be seen <a href="http://www.magentocommerce.com/knowledge-base/entry/new-features-ce19-ee114">here</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SagePay, OneStepCheckout, 'Transaction could not be cancelled and order was not created, cart was modified while customer on payment pages']]></title>
    <link href="http://edmondscommerce.github.io/magento/sagepay-onestepcheckout-transaction-could-not-be-cancelled-and-order-was-not-created-cart-was-modified-while-customer-on-payment-pages.html"/>
    <updated>2014-04-24T19:17:35+01:00</updated>
    <id>http://edmondscommerce.github.io/magento/sagepay-onestepcheckout-transaction-could-not-be-cancelled-and-order-was-not-created-cart-was-modified-while-customer-on-payment-pages</id>
    <content type="html"><![CDATA[<p>I spent this morning dealing with a Magento sit that was unable to process Credit Card payments when they were placed with SagePay.</p>

<p>When a customer tried to place an order they were able to enter that card details, but were then presented with an alert with the following message</p>

<blockquote><p>Your order could not be completed, please try again. Thanks.</p></blockquote>

<p>They were using the <a href="https://github.com/ebizmarts/sage-pay-suite-ce">EbizMarts SagePay CE Module</a>, so I had a look around to see if the error was known</p>

<p>It appears that a recent release of the SagePay Module introduces some additional checks before creating the order and the current release of the <a href="http://www.onestepcheckout.com/">OneStepCheckout</a> is not compatible with this.</p>

<p>If you look straight at the SagePay Logs you may also see the following errors, which may indicate the same problem.</p>

<ul>
<li>DEBUG: 4028 : The related transaction cannot be found.</li>
<li>DEBUG: Your order could not be completed, please try again. Thanks.</li>
<li>CRIT: Transaction XXXXXXXXX-XXXX-XX-XX-XX-XX-XX could not be cancelled and order was not created, cart was modified while customer on payment pages.</li>
</ul>


<p>Thankfully there is a simple fix for this. In the <strong>app/code/local/Idev/OneStepCheckout/controllers/IndexController.php</strong> file you need to add the following line to the indexAction method</p>

<p><code>php
Mage::getSingleton('checkout/session')-&gt;setCartWasUpdated(false);
</code></p>

<p>Just before</p>

<p><code>php
$this-&gt;loadLayout();
</code></p>

<p>and then everything will work correctly.</p>
]]></content>
  </entry>
  
</feed>
