<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: auth | Edmonds Commerce Dev Blog]]></title>
  <link href="http://edmondscommerce.github.io/tag/auth/atom.xml" rel="self"/>
  <link href="http://edmondscommerce.github.io/"/>
  <updated>2013-11-29T16:52:40+00:00</updated>
  <id>http://edmondscommerce.github.io/</id>
  <author>
    <name><![CDATA[EdmondsCommerce Development Team]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Zend Framework Rest HTTP Basic Authentication]]></title>
    <link href="http://edmondscommerce.github.io/zend%20framework/zend-framework-rest-http-basic-authentication.html"/>
    <updated>2012-02-21T12:43:44+00:00</updated>
    <id>http://edmondscommerce.github.io/zend%20framework/zend-framework-rest-http-basic-authentication</id>
    <content type="html"><![CDATA[<p>I have recently been working on a Magento project that required a custom API integration with Zen Desk.</p>

<p>Magento is based on Zend Framework which is nice because it means we can use the Zend_Rest_Client object to handle the API integration which provides a nice layer of abstraction and sorts out a lot of the heavy lifting required.</p>

<p>However I came across a terminal issue trying to get it working properly with HTTP Basic Authentication which the Zen Desk API uses.</p>

<p>I found some instructions which recommended creating a Zend_Uri_Http object and then setting the username and password against this. However as Zen Desk uses the email address as the username component, this failed completely.</p>

<p>In the end the solution I found was to grab the static HTTP client object that the REST client is built upon and call the public setAuth method on this. This way the Authorisation header is correctly created, encoded and appended to the headers.</p>

<p>Logically it feels like a dirty way to do things, grabbing the HTTP client statically to do this, but it works and I can&rsquo;t see how else you would do it.</p>

<p>For info here is the code:</p>

<p>```php</p>

<p>/**</p>

<pre><code> * @return Zend_Rest_Client 
 */
protected function getClient() {
    if (null === $this-&gt;_client) {
        $url = $this-&gt;getApiUrl();
        $uri = Zend_Uri_Http::fromString($url);
        $this-&gt;_client = new Zend_Rest_Client($uri);
        Zend_Service_Abstract::getHttpClient()-&gt;setAuth($this-&gt;getUsername(),$this-&gt;getPassword());
    }
    return $this-&gt;_client;
}
</code></pre>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Yii Setting up Authorisation - the Missing Manual]]></title>
    <link href="http://edmondscommerce.github.io/php/yii-setting-up-authorisation-the-missing-manual.html"/>
    <updated>2012-02-01T17:25:50+00:00</updated>
    <id>http://edmondscommerce.github.io/php/yii-setting-up-authorisation-the-missing-manual</id>
    <content type="html"><![CDATA[<p>Reading the generally very clear and concise Yii documentation you can quickly get started with the framework.</p>

<p>However one issue that I struggled to be clear on is setting up the database driven authorisation system.</p>

<p>I recommend reading <a href="http://danaluther.blogspot.com/2010/03/yii-authentication-via-database.html">this blog post</a> which finally helped me to understand wth I was supposed to do. The official documentation is <a href="http://www.yiiframework.com/doc/guide/1.1/en/topics.auth#defining-authorization-hierarchy">here</a> which you should also read.</p>

<p>There are a few key points that are not really clear but are important.</p>

<p><strong>1. You need to create the tables.
</strong>
There is a file: yii/framework/web/auth/schema-mysql.sql</p>

<p>You need to run this on your database to build the necessary tables#</p>

<p><strong>2. Creating the rules &ndash; use the Yii Shell
</strong>
You will see examples of PHP code that defines rules etc. You may wonder where the hell you are supposed to put this code and also is it really a good idea to run this kind of code on every page load, seems odd.</p>

<p>Well the answer is you are only meant to run it once and you can either make a PHP script that runs it or even nicer is to use the Yii interactive shell and paste the lines in one at a time to execute them.</p>

<p><strong>Using the Yii Shell</strong></p>

<p>Go to your web root on the command line (I&rsquo;m using Linux, good luck if you aren&rsquo;t)
```</p>

<p>cd ~/Projects/yii-projects/public</p>

<p>```</p>

<p>Now run the yiic tool from the web root with the shell flag
```</p>

<p>protected/yiic shell</p>

<p>```</p>

<p>You now have an interactive PHP shell with the Yii framework available. You can create models, crud etc as you might have done in Gii, but you can also run PHP code directly, including working with Yii objects &ndash; such as the authManager</p>

<p>Try this:</p>

<p>Paste this line into your Yii shell and hit return
```</p>

<p>$auth=Yii:app()&ndash;>authManager;</p>

<p>```</p>

<p>Then this line and hit return
```</p>

<p>var_dump($auth);</p>

<p>```</p>

<p>You should see a var dump of the CDbAuthManager object</p>

<p>Now when you see examples such as this:
```php</p>

<p>$auth=Yii::app()&ndash;>authManager;</p>

<p>$auth->createOperation(&lsquo;createPost&rsquo;,&lsquo;create a post&rsquo;);
$auth->createOperation(&lsquo;readPost&rsquo;,&lsquo;read a post&rsquo;);
$auth->createOperation(&lsquo;updatePost&rsquo;,&lsquo;update a post&rsquo;);
$auth->createOperation(&lsquo;deletePost&rsquo;,&lsquo;delete a post&rsquo;);</p>

<p>```</p>

<p>You realise that this is something you can do ONCE to set up these roles, and a great way to do that is via the Yii Shell.</p>

<p>Have fun ;)</p>
]]></content>
  </entry>
  
</feed>
