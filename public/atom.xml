<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Edmonds Commerce Dev Blog]]></title>
  <link href="http://edmondscommerce.github.io/atom.xml" rel="self"/>
  <link href="http://edmondscommerce.github.io/"/>
  <updated>2015-05-13T13:59:15+01:00</updated>
  <id>http://edmondscommerce.github.io/</id>
  <author>
    <name><![CDATA[EdmondsCommerce Development Team]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[PHP json_encode Failing with No Clear Reason + Solution]]></title>
    <link href="http://edmondscommerce.github.io/php/php-json-encode-failing-with-no-clear-reason-plus-solution.html"/>
    <updated>2015-05-13T13:05:35+01:00</updated>
    <id>http://edmondscommerce.github.io/php/php-json-encode-failing-with-no-clear-reason-plus-solution</id>
    <content type="html"><![CDATA[<p>I recently had an issue on a server that has been updated to use PHP 5.6. Code that was using json_encode had stopped working for no apparent reason.</p>

<p>Reading into the issue, it seems that one scenario that this would happen is if the strings in an array were not valid utf8. An obvious solution to this was to encode the strings.</p>

<p>Here is a simple function to process an array ready for use with json_encode. It solved the issue for me, maybe it can help you too?</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Process an array and utf8 encode all leaf elements ready for json encode</span>
</span><span class='line'><span class="sd"> * @param array &amp;$arr - reference to an array to process</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">function</span> <span class="nf">utf8_array_for_json</span><span class="p">(</span><span class="k">array</span> <span class="o">&amp;</span><span class="nv">$arr</span><span class="p">){</span>
</span><span class='line'>    <span class="nb">array_walk_recursive</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$valByRef</span><span class="p">){</span><span class="nv">$valByRef</span> <span class="o">=</span> <span class="nx">utf8_encode</span><span class="p">(</span><span class="nv">$valByRef</span><span class="p">);});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>To use this, simply pass in your array (by reference) before calling json_encode on the array, for example:</p>

<figure class='code panel panel-default'><figcaption class='panel-heading'><h3 class='panel-title'></h3></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">utf8_array_for_json</span><span class="p">(</span><span class="nv">$myArray</span><span class="p">);</span>
</span><span class='line'><span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$myArray</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
</feed>
